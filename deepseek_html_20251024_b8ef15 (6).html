<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Clicker Game - –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #fdbb2d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .auth-section {
            display: flex;
            gap: 10px;
        }
        
        button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .admin-btn {
            background: rgba(220, 53, 69, 0.7);
        }
        
        .admin-btn:hover {
            background: rgba(220, 53, 69, 0.9);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
            .chat-section, .friends-section, .cases-section, .trade-section {
                grid-column: 1 / -1;
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .game-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            text-align: center;
        }
        
        .admin-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            grid-column: 1 / -1;
        }
        
        .chat-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
        }
        
        .friends-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
        }
        
        .cases-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            grid-column: 1 / -1;
        }
        
        .trade-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            grid-column: 1 / -1;
        }
        
        .admin-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .admin-controls {
                grid-template-columns: 1fr;
            }
        }
        
        .admin-panel {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
        }
        
        .admin-panel h3 {
            margin-bottom: 15px;
            color: #fdbb2d;
        }
        
        .user-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .user-actions {
            display: flex;
            gap: 8px;
        }
        
        .user-actions button {
            padding: 5px 10px;
            font-size: 0.8rem;
        }
        
        .click-area {
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, #fdbb2d, #b21f1f);
            border-radius: 50%;
            margin: 30px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.1s ease;
            user-select: none;
            position: relative;
            overflow: hidden;
        }
        
        .click-area:active {
            transform: scale(0.95);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        }
        
        .click-area.blocked {
            background: linear-gradient(135deg, #666, #333);
            cursor: not-allowed;
        }
        
        .click-area.blocked:active {
            transform: scale(1);
        }
        
        .blocked-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            text-align: center;
            padding: 10px;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .trend-indicator {
            font-size: 0.8rem;
            margin-top: 2px;
        }
        
        .trend-up {
            color: #4CAF50;
        }
        
        .trend-down {
            color: #F44336;
        }
        
        .trend-neutral {
            color: #FFC107;
        }
        
        .cps-warning {
            color: #ff6b6b;
            font-weight: bold;
            margin-top: 10px;
            min-height: 24px;
        }
        
        .leaderboard-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .leaderboard {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }
        
        .leaderboard-item.current-user {
            background: rgba(253, 187, 45, 0.3);
            border-left: 5px solid #fdbb2d;
        }
        
        .rank {
            font-weight: bold;
            width: 30px;
        }
        
        .player-name {
            flex: 1;
            margin: 0 15px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .player-score {
            font-weight: bold;
        }
        
        .auth-modal, .nickname-modal, .admin-modal, .event-modal, .clicks-modal, .friends-modal, .case-result-modal, .admin-code-modal, .trade-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .auth-form, .nickname-form, .admin-form, .event-form, .clicks-form, .friends-form, .case-result-content, .admin-code-form, .trade-form {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }
        
        .trade-form {
            max-width: 600px;
        }
        
        .case-result-content {
            text-align: center;
            max-width: 400px;
            animation: caseOpen 0.5s ease;
        }
        
        @keyframes caseOpen {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .auth-form h2, .nickname-form h2, .admin-form h2, .event-form h2, .clicks-form h2, .friends-form h2, .case-result-content h2, .admin-code-form h2, .trade-form h2 {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .auth-form input, .nickname-form input, .admin-form input, .event-form input, .event-form select, .clicks-form input, .friends-form input, .admin-code-form input, .trade-form input {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .auth-buttons, .nickname-buttons, .admin-buttons, .event-buttons, .clicks-buttons, .friends-buttons, .case-result-buttons, .admin-code-buttons, .trade-buttons {
            display: flex;
            gap: 10px;
        }
        
        .auth-buttons button, .nickname-buttons button, .admin-buttons button, .event-buttons button, .clicks-buttons button, .friends-buttons button, .case-result-buttons button, .admin-code-buttons button, .trade-buttons button {
            flex: 1;
        }
        
        .close-modal {
            background: rgba(255, 255, 255, 0.1);
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .game-info {
            margin-top: 20px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .change-nickname {
            margin-top: 10px;
            font-size: 0.8rem;
            color: #fdbb2d;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .leaderboard-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .leaderboard-controls button {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        .leaderboard-controls button.active {
            background: rgba(253, 187, 45, 0.5);
        }
        
        .cps-meter {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            margin-top: 10px;
            overflow-y: hidden;
        }
        
        .cps-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #FFC107, #F44336);
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .admin-only {
            display: none;
        }
        
        .admin-badge {
            background: #dc3545;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 10px;
        }
        
        .event-notification {
            background: rgba(76, 175, 80, 0.3);
            padding: 10px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #4CAF50;
        }
        
        .admin-quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .action-with-input {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .action-with-input input {
            padding: 8px;
            border-radius: 5px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
        }
        
        /* –ß–∞—Ç —Å—Ç–∏–ª–∏ */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            max-height: 400px;
        }
        
        .chat-message {
            margin-bottom: 10px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            word-wrap: break-word;
        }
        
        .chat-message.admin-action {
            background: rgba(220, 53, 69, 0.3);
            border-left: 3px solid #dc3545;
        }
        
        .chat-message.system {
            background: rgba(255, 193, 7, 0.3);
            border-left: 3px solid #FFC107;
            font-style: italic;
        }
        
        .message-sender {
            font-weight: bold;
            margin-right: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .message-text {
            margin-top: 3px;
        }
        
        .chat-input-container {
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .send-button {
            padding: 12px 20px;
            white-space: nowrap;
        }
        
        /* –ì–∞–ª–æ—á–∫–∏ */
        .verified-badge {
            color: #1DA1F2;
            font-size: 0.9rem;
        }
        
        .admin-badge-chat {
            background: #dc3545;
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.6rem;
            margin-left: 5px;
        }
        
        .user-with-badge {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* –°–∏—Å—Ç–µ–º–∞ –¥—Ä—É–∑–µ–π */
        .friends-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            max-height: 300px;
        }
        
        .friend-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .friend-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .friend-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #4CAF50;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .friend-actions {
            display: flex;
            gap: 5px;
        }
        
        .friend-actions button {
            padding: 5px 10px;
            font-size: 0.7rem;
        }
        
        .friends-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .friends-controls button {
            flex: 1;
        }
        
        .trend-chart {
            height: 100px;
            margin-top: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 10px;
            position: relative;
        }
        
        .trend-line {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 80%;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
        }
        
        .trend-bar {
            width: 8px;
            background: linear-gradient(to top, #4CAF50, #FFC107);
            border-radius: 2px;
            transition: height 0.3s ease;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–µ–π—Å–æ–≤ */
        .cases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .case-item {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .case-item:hover {
            transform: translateY(-5px);
            border-color: #fdbb2d;
            box-shadow: 0 10px 20px rgba(253, 187, 45, 0.3);
        }
        
        .case-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #fdbb2d;
        }
        
        .case-price {
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        .case-chances {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }
        
        .upgrades-list {
            margin-top: 20px;
        }
        
        .upgrade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .upgrade-rarity-common { color: #ffffff; }
        .upgrade-rarity-uncommon { color: #4CAF50; }
        .upgrade-rarity-rare { color: #2196F3; }
        .upgrade-rarity-epic { color: #9C27B0; }
        .upgrade-rarity-legendary { color: #FF9800; }
        
        .bonus-display {
            background: rgba(253, 187, 45, 0.3);
            padding: 10px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
        }

        .case-premium {
            border-color: #FFD700;
            background: linear-gradient(135deg, #1a2a6c, #9C27B0);
        }

        .case-legendary {
            border-color: #FF9800;
            background: linear-gradient(135deg, #1a2a6c, #FF9800);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç—Ä–µ–π–¥–∞ */
        .trade-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .trade-side {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
        }

        .trade-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #fdbb2d;
        }

        .trade-items {
            min-height: 200px;
            margin-bottom: 15px;
        }

        .trade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }

        .trade-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .trade-controls button {
            flex: 1;
        }

        .trade-offers {
            margin-top: 20px;
        }

        .trade-offer {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .trade-offer-info {
            margin-bottom: 10px;
        }

        .trade-offer-actions {
            display: flex;
            gap: 10px;
        }

        .trade-offer-actions button {
            flex: 1;
        }

        .selected-upgrade {
            background: rgba(253, 187, 45, 0.3);
            border: 1px solid #fdbb2d;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">FireClicker <span class="admin-badge" id="adminBadge" style="display: none;">ADMIN</span></div>
            <div class="user-info">
                <div id="userDisplay" class="user-display" style="display: none;">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <span id="userName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                    <span id="userVerified" class="verified-badge" style="display: none;">‚úì</span>
                </div>
                <div class="auth-section">
                    <button id="adminPanelBtn" class="admin-btn admin-only">–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å</button>
                    <button id="loginBtn">–í–æ–π—Ç–∏</button>
                    <button id="registerBtn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                    <button id="logoutBtn" style="display: none;">–í—ã–π—Ç–∏</button>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <div class="game-section">
                <h2 class="section-title">–ö–ª–∏–∫–µ—Ä</h2>
                <div id="eventNotification" class="event-notification" style="display: none;">
                    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–æ–±—ã—Ç–∏–∏ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
                <div class="click-area" id="clickArea">
                    <span id="clickText">–ö–õ–ò–ö–ê–ô!</span>
                    <div class="blocked-overlay" id="blockedOverlay" style="display: none;">–°–õ–ò–®–ö–û–ú –ë–´–°–¢–†–û!</div>
                </div>
                <div class="cps-meter">
                    <div class="cps-fill" id="cpsFill"></div>
                </div>
                <div class="cps-warning" id="cpsWarning"></div>
                <div class="stats">
                    <div class="stat">
                        <div>–ö–ª–∏–∫–∏</div>
                        <div class="stat-value" id="clickCount">0</div>
                    </div>
                    <div class="stat">
                        <div>–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</div>
                        <div class="stat-value" id="bestScore">0</div>
                    </div>
                    <div class="stat">
                        <div>–ö–ª–∏–∫–æ–≤/—Å–µ–∫</div>
                        <div class="stat-value" id="cpsValue">0</div>
                    </div>
                </div>
                <div class="bonus-display" id="bonusDisplay" style="display: none;">
                    –ë–æ–Ω—É—Å –∫ –∫–ª–∏–∫—É: +<span id="bonusValue">0</span>
                </div>
                <div class="game-info">
                    <p>–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –ø–æ–ø–∞—Å—Ç—å –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥!</p>
                    <p>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –Ω–µ –±–æ–ª–µ–µ 12 –∫–ª–∏–∫–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É</p>
                    <div class="change-nickname" id="changeNickname" style="display: none;">–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∏–∫–Ω–µ–π–º</div>
                </div>
            </div>
            
            <div class="cases-section">
                <h2 class="section-title">–ö–µ–π—Å—ã —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏</h2>
                <div class="cases-grid">
                    <div class="case-item" id="basicCase">
                        <div class="case-name">üì¶ –ë–∞–∑–æ–≤—ã–π –∫–µ–π—Å</div>
                        <div class="case-price">–¶–µ–Ω–∞: 250 –∫–ª–∏–∫–æ–≤</div>
                        <div class="case-chances">
                            –®–∞–Ω—Å—ã: 65% +0.1 | 25% +0.2 | 8% +0.5 | 2% +1.0
                        </div>
                        <button>–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å</button>
                    </div>
                    
                    <div class="case-item" id="advancedCase">
                        <div class="case-name">‚ö° –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∫–µ–π—Å</div>
                        <div class="case-price">–¶–µ–Ω–∞: 750 –∫–ª–∏–∫–æ–≤</div>
                        <div class="case-chances">
                            –®–∞–Ω—Å—ã: 50% +0.2 | 30% +0.5 | 15% +1.0 | 5% +2.0
                        </div>
                        <button>–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å</button>
                    </div>
                    
                    <div class="case-item case-premium" id="premiumCase">
                        <div class="case-name">üíé –ü—Ä–µ–º–∏—É–º –∫–µ–π—Å</div>
                        <div class="case-price">–¶–µ–Ω–∞: 1500 –∫–ª–∏–∫–æ–≤</div>
                        <div class="case-chances">
                            –®–∞–Ω—Å—ã: 40% +0.5 | 35% +1.0 | 20% +2.0 | 5% +3.0
                        </div>
                        <button>–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å</button>
                    </div>
                    
                    <div class="case-item case-legendary" id="legendaryCase">
                        <div class="case-name">üåü –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–µ–π—Å</div>
                        <div class="case-price">–¶–µ–Ω–∞: 3000 –∫–ª–∏–∫–æ–≤</div>
                        <div class="case-chances">
                            –®–∞–Ω—Å—ã: 30% +1.0 | 40% +2.0 | 25% +3.0 | 5% +5.0
                        </div>
                        <button>–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å</button>
                    </div>
                </div>
                
                <div class="upgrades-list" id="upgradesList">
                    <h3 style="margin-bottom: 15px;">–í–∞—à–∏ —É–ª—É—á—à–µ–Ω–∏—è</h3>
                    <!-- –°–ø–∏—Å–æ–∫ —É–ª—É—á—à–µ–Ω–∏–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
            
            <div class="trade-section">
                <h2 class="section-title">–û–±–º–µ–Ω —Å –∏–≥—Ä–æ–∫–∞–º–∏</h2>
                <div class="trade-controls">
                    <button id="createTradeBtn">–°–æ–∑–¥–∞—Ç—å –æ–±–º–µ–Ω</button>
                    <button id="refreshTrades">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                </div>
                <div class="trade-offers" id="tradeOffers">
                    <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –æ–±–º–µ–Ω–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
            
            <div class="leaderboard-section">
                <h2 class="section-title">–õ–∏–¥–µ—Ä–±–æ—Ä–¥</h2>
                <div class="leaderboard-controls">
                    <button id="showTop10" class="active">–¢–æ–ø-10</button>
                    <button id="showTop25">–¢–æ–ø-25</button>
                    <button id="showAll">–í—Å–µ –∏–≥—Ä–æ–∫–∏</button>
                </div>
                <ul class="leaderboard" id="leaderboard">
                    <!-- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω —á–µ—Ä–µ–∑ JS -->
                </ul>
            </div>
            
            <div class="friends-section">
                <h2 class="section-title">–î—Ä—É–∑—å—è</h2>
                <div class="friends-controls">
                    <button id="addFriendBtn">–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</button>
                    <button id="refreshFriends">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
                <div class="friends-list" id="friendsList">
                    <!-- –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
            
            <div class="chat-section">
                <h2 class="section-title">–ß–∞—Ç</h2>
                <div class="chat-messages" id="chatMessages">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." maxlength="200">
                    <button class="send-button" id="sendMessage">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="admin-section admin-only" id="adminSection">
                <h2 class="section-title">–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å</h2>
                <div class="admin-controls">
                    <div class="admin-panel">
                        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                        <div class="user-list" id="userList">
                            <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω —á–µ—Ä–µ–∑ JS -->
                        </div>
                        <button id="refreshUsers">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                    </div>
                    
                    <div class="admin-panel">
                        <h3>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –∫–ª–∏–∫–∞–º–∏</h3>
                        <div class="admin-quick-actions">
                            <div class="action-with-input">
                                <input type="number" id="clicksToOnlineInput" placeholder="–ö–æ–ª-–≤–æ –∫–ª–∏–∫–æ–≤" value="1000">
                                <button id="addClicksToOnline">–î–æ–±–∞–≤–∏—Ç—å –æ–Ω–ª–∞–π–Ω</button>
                            </div>
                            <div class="action-with-input">
                                <input type="number" id="clicksToMeInput" placeholder="–ö–æ–ª-–≤–æ –∫–ª–∏–∫–æ–≤" value="5000">
                                <button id="addMyClicks">–î–æ–±–∞–≤–∏—Ç—å —Å–µ–±–µ</button>
                            </div>
                            <div class="action-with-input">
                                <input type="number" id="clicksToAllInput" placeholder="–ö–æ–ª-–≤–æ –∫–ª–∏–∫–æ–≤" value="1000">
                                <button id="addClicksToAll">–î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ–º</button>
                            </div>
                            <button id="createEvent" class="admin-only">–°–æ–∑–¥–∞—Ç—å –∏–≤–µ–Ω—Ç</button>
                            <button id="resetAllScores">–û–±–Ω—É–ª–∏—Ç—å –≤—Å–µ</button>
                            <button id="deleteInactive">–£–¥–∞–ª–∏—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="auth-modal" id="authModal">
        <div class="auth-form">
            <h2 id="authModalTitle">–í—Ö–æ–¥</h2>
            <input type="email" id="authEmail" placeholder="Email">
            <input type="password" id="authPassword" placeholder="–ü–∞—Ä–æ–ª—å">
            <div class="auth-buttons">
                <button id="authSubmit">–í–æ–π—Ç–∏</button>
                <button id="authCancel">–û—Ç–º–µ–Ω–∞</button>
            </div>
            <div class="close-modal" id="closeAuthModal">√ó</div>
        </div>
    </div>
    
    <div class="nickname-modal" id="nicknameModal">
        <div class="nickname-form">
            <h2>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∏–∫–Ω–µ–π–º</h2>
            <input type="text" id="nicknameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫–Ω–µ–π–º" maxlength="15">
            <div class="nickname-buttons">
                <button id="saveNickname">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button id="cancelNickname">–û—Ç–º–µ–Ω–∞</button>
            </div>
            <div class="close-modal" id="closeNicknameModal">√ó</div>
        </div>
    </div>
    
    <div class="admin-modal" id="adminModal">
        <div class="admin-form">
            <h2 id="adminModalTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            <div id="adminUserInfo" style="margin-bottom: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;"></div>
            <input type="number" id="adminClicksInput" placeholder="–ù–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤">
            <input type="number" id="adminBestScoreInput" placeholder="–ù–æ–≤—ã–π –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç">
            <div class="admin-buttons">
                <button id="adminSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button id="adminDelete">–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                <button id="toggleVerified">–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≥–∞–ª–æ—á–∫—É</button>
                <button id="adminCancel">–û—Ç–º–µ–Ω–∞</button>
            </div>
            <div class="close-modal" id="closeAdminModal">√ó</div>
        </div>
    </div>
    
    <div class="event-modal" id="eventModal">
        <div class="event-form">
            <h2>–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</h2>
            <select id="eventMultiplier">
                <option value="2">2x - –î–≤–æ–π–Ω—ã–µ –∫–ª–∏–∫–∏</option>
                <option value="3">3x - –¢—Ä–æ–π–Ω—ã–µ –∫–ª–∏–∫–∏</option>
                <option value="5">5x - –ü—è—Ç–µ—Ä–Ω—ã–µ –∫–ª–∏–∫–∏</option>
                <option value="10">10x - –î–µ—Å—è—Ç–µ—Ä–Ω—ã–µ –∫–ª–∏–∫–∏</option>
            </select>
            <select id="eventDuration">
                <option value="5">5 –º–∏–Ω—É—Ç</option>
                <option value="10">10 –º–∏–Ω—É—Ç</option>
                <option value="30">30 –º–∏–Ω—É—Ç</option>
                <option value="60">1 —á–∞—Å</option>
                <option value="120">2 —á–∞—Å–∞</option>
                <option value="360">6 —á–∞—Å–æ–≤</option>
                <option value="720">12 —á–∞—Å–æ–≤</option>
                <option value="1440">24 —á–∞—Å–∞</option>
            </select>
            <div class="event-buttons">
                <button id="startEvent">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
                <button id="stopEvent">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
                <button id="cancelEvent">–û—Ç–º–µ–Ω–∞</button>
            </div>
            <div class="close-modal" id="closeEventModal">√ó</div>
        </div>
    </div>
    
    <div class="clicks-modal" id="customClicksModal">
        <div class="clicks-form">
            <h2 id="customClicksTitle">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–∫–æ–≤</h2>
            <input type="number" id="customClicksInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤">
            <div class="clicks-buttons">
                <button id="confirmCustomClicks">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button id="cancelCustomClicks">–û—Ç–º–µ–Ω–∞</button>
            </div>
            <div class="close-modal" id="closeCustomClicksModal">√ó</div>
        </div>
    </div>
    
    <div class="friends-modal" id="friendsModal">
        <div class="friends-form">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</h2>
            <input type="text" id="friendSearchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ email –∏–ª–∏ –Ω–∏–∫–Ω–µ–π–º">
            <div class="friends-buttons">
                <button id="searchFriend">–ù–∞–π—Ç–∏</button>
                <button id="cancelFriend">–û—Ç–º–µ–Ω–∞</button>
            </div>
            <div id="friendSearchResults" style="margin-top: 15px;">
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
            <div class="close-modal" id="closeFriendsModal">√ó</div>
        </div>
    </div>

    <!-- –ù–æ–≤—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è –∫–µ–π—Å–æ–≤ –∏ –∫–æ–¥–∞ –∞–¥–º–∏–Ω–∞ -->
    <div class="case-result-modal" id="caseResultModal">
        <div class="case-result-content">
            <h2 id="caseResultTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞</h2>
            <div id="caseResultContent" style="font-size: 1.2rem; margin: 20px 0;"></div>
            <div class="case-result-buttons">
                <button id="closeCaseResult">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
    
    <div class="admin-code-modal" id="adminCodeModal">
        <div class="admin-code-form">
            <h2>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
            <p>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:</p>
            <input type="text" id="adminCodeInput" placeholder="–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è">
            <div class="admin-code-buttons">
                <button id="confirmAdminCode">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                <button id="cancelAdminCode">–û—Ç–º–µ–Ω–∞</button>
            </div>
            <div class="close-modal" id="closeAdminCodeModal">√ó</div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ–±–º–µ–Ω–∞ -->
    <div class="trade-modal" id="tradeModal">
        <div class="trade-form">
            <h2 id="tradeModalTitle">–°–æ–∑–¥–∞–Ω–∏–µ –æ–±–º–µ–Ω–∞</h2>
            <div class="trade-container">
                <div class="trade-side">
                    <h3>–í—ã –æ—Ç–¥–∞–µ—Ç–µ:</h3>
                    <div class="trade-items" id="myTradeItems">
                        <!-- –í–∞—à–∏ –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è –æ–±–º–µ–Ω–∞ -->
                    </div>
                    <div class="action-with-input">
                        <input type="number" id="myClicksInput" placeholder="–ö–ª–∏–∫–∏ –¥–ª—è –æ–±–º–µ–Ω–∞" min="0">
                        <button id="addMyUpgrade">–î–æ–±–∞–≤–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ</button>
                    </div>
                </div>
                <div class="trade-arrow">‚áÑ</div>
                <div class="trade-side">
                    <h3>–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ:</h3>
                    <div class="trade-items" id="theirTradeItems">
                        <!-- –ü—Ä–µ–¥–º–µ—Ç—ã –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ -->
                    </div>
                    <div class="action-with-input">
                        <input type="number" id="theirClicksInput" placeholder="–ö–ª–∏–∫–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è" min="0">
                        <button id="addTheirUpgrade">–î–æ–±–∞–≤–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ</button>
                    </div>
                </div>
            </div>
            <div class="action-with-input">
                <input type="text" id="tradePlayerInput" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞ –¥–ª—è –æ–±–º–µ–Ω–∞">
            </div>
            <div class="trade-buttons">
                <button id="sendTradeOffer">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>
                <button id="cancelTrade">–û—Ç–º–µ–Ω–∞</button>
            </div>
            <div class="close-modal" id="closeTradeModal">√ó</div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD4mvrBrKNEmPQ7JDfbnEGAxb9ETen8KsA",
            authDomain: "clicking-697ae.firebaseapp.com",
            projectId: "clicking-697ae",
            storageBucket: "clicking-697ae.firebasestorage.app",
            messagingSenderId: "479295856325",
            appId: "1:479295856325:web:dc0b0dcf661cd66941daac",
            databaseURL: "https://clicking-697ae-default-rtdb.firebaseio.com/"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            clicks: 0,
            bestScore: 0,
            clickMultiplier: 1,
            previousClicks: 0,
            previousBestScore: 0,
            previousCPS: 0,
            clickHistory: []
        };

        // –°–∏—Å—Ç–µ–º–∞ —É–ª—É—á—à–µ–Ω–∏–π
        let upgrades = {
            totalBonus: 0,
            items: []
        };

        // –°–∏—Å—Ç–µ–º–∞ –æ–±–º–µ–Ω–∞
        let currentTrade = {
            myItems: [],
            myClicks: 0,
            theirItems: [],
            theirClicks: 0,
            targetPlayer: null
        };

        // –ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∞
        const ADMIN_CONFIRMATION_CODE = "ADMIN2024";

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
        let leaderboardLimit = 10;

        // –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –æ—Ç –±—ã—Å—Ç—Ä—ã—Ö –∫–ª–∏–∫–æ–≤
        const MAX_CPS = 12;
        let clickTimestamps = [];
        let currentCPS = 0;
        let isBlocked = false;
        let blockTimeout = null;

        // –ê–¥–º–∏–Ω—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        const ADMIN_EMAILS = ['magmaplasm@gmail.com'];
        let isAdmin = false;
        let selectedUser = null;
        let currentAction = null;

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const clickArea = document.getElementById('clickArea');
        const clickText = document.getElementById('clickText');
        const blockedOverlay = document.getElementById('blockedOverlay');
        const clickCount = document.getElementById('clickCount');
        const bestScore = document.getElementById('bestScore');
        const cpsValue = document.getElementById('cpsValue');
        const cpsWarning = document.getElementById('cpsWarning');
        const cpsFill = document.getElementById('cpsFill');
        const leaderboard = document.getElementById('leaderboard');
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const adminPanelBtn = document.getElementById('adminPanelBtn');
        const adminSection = document.getElementById('adminSection');
        const adminBadge = document.getElementById('adminBadge');
        const authModal = document.getElementById('authModal');
        const authModalTitle = document.getElementById('authModalTitle');
        const authEmail = document.getElementById('authEmail');
        const authPassword = document.getElementById('authPassword');
        const authSubmit = document.getElementById('authSubmit');
        const authCancel = document.getElementById('authCancel');
        const closeAuthModal = document.getElementById('closeAuthModal');
        const userDisplay = document.getElementById('userDisplay');
        const userName = document.getElementById('userName');
        const userAvatar = document.getElementById('userAvatar');
        const userVerified = document.getElementById('userVerified');
        const changeNickname = document.getElementById('changeNickname');
        const nicknameModal = document.getElementById('nicknameModal');
        const nicknameInput = document.getElementById('nicknameInput');
        const saveNickname = document.getElementById('saveNickname');
        const cancelNickname = document.getElementById('cancelNickname');
        const closeNicknameModal = document.getElementById('closeNicknameModal');
        const showTop10 = document.getElementById('showTop10');
        const showTop25 = document.getElementById('showTop25');
        const showAll = document.getElementById('showAll');
        const eventNotification = document.getElementById('eventNotification');
        const userList = document.getElementById('userList');
        const refreshUsers = document.getElementById('refreshUsers');
        const resetAllScores = document.getElementById('resetAllScores');
        const addClicksToAll = document.getElementById('addClicksToAll');
        const deleteInactive = document.getElementById('deleteInactive');
        const addClicksToOnline = document.getElementById('addClicksToOnline');
        const addMyClicks = document.getElementById('addMyClicks');
        const createEvent = document.getElementById('createEvent');
        const adminModal = document.getElementById('adminModal');
        const adminModalTitle = document.getElementById('adminModalTitle');
        const adminUserInfo = document.getElementById('adminUserInfo');
        const adminClicksInput = document.getElementById('adminClicksInput');
        const adminBestScoreInput = document.getElementById('adminBestScoreInput');
        const adminSave = document.getElementById('adminSave');
        const adminDelete = document.getElementById('adminDelete');
        const toggleVerified = document.getElementById('toggleVerified');
        const adminCancel = document.getElementById('adminCancel');
        const closeAdminModal = document.getElementById('closeAdminModal');
        const eventModal = document.getElementById('eventModal');
        const eventMultiplier = document.getElementById('eventMultiplier');
        const eventDuration = document.getElementById('eventDuration');
        const startEvent = document.getElementById('startEvent');
        const stopEvent = document.getElementById('stopEvent');
        const cancelEvent = document.getElementById('cancelEvent');
        const closeEventModal = document.getElementById('closeEventModal');
        const customClicksModal = document.getElementById('customClicksModal');
        const customClicksTitle = document.getElementById('customClicksTitle');
        const customClicksInput = document.getElementById('customClicksInput');
        const confirmCustomClicks = document.getElementById('confirmCustomClicks');
        const cancelCustomClicks = document.getElementById('cancelCustomClicks');
        const closeCustomClicksModal = document.getElementById('closeCustomClicksModal');
        const clicksToOnlineInput = document.getElementById('clicksToOnlineInput');
        const clicksToMeInput = document.getElementById('clicksToMeInput');
        const clicksToAllInput = document.getElementById('clicksToAllInput');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendMessage = document.getElementById('sendMessage');
        const friendsList = document.getElementById('friendsList');
        const addFriendBtn = document.getElementById('addFriendBtn');
        const refreshFriends = document.getElementById('refreshFriends');
        const friendsModal = document.getElementById('friendsModal');
        const friendSearchInput = document.getElementById('friendSearchInput');
        const searchFriend = document.getElementById('searchFriend');
        const cancelFriend = document.getElementById('cancelFriend');
        const closeFriendsModal = document.getElementById('closeFriendsModal');
        const friendSearchResults = document.getElementById('friendSearchResults');
        const bonusDisplay = document.getElementById('bonusDisplay');
        const bonusValue = document.getElementById('bonusValue');

        // –ù–æ–≤—ã–µ DOM —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∫–µ–π—Å–æ–≤ –∏ –∫–æ–¥–∞ –∞–¥–º–∏–Ω–∞
        const basicCase = document.getElementById('basicCase');
        const advancedCase = document.getElementById('advancedCase');
        const premiumCase = document.getElementById('premiumCase');
        const legendaryCase = document.getElementById('legendaryCase');
        const upgradesList = document.getElementById('upgradesList');
        const caseResultModal = document.getElementById('caseResultModal');
        const caseResultTitle = document.getElementById('caseResultTitle');
        const caseResultContent = document.getElementById('caseResultContent');
        const closeCaseResult = document.getElementById('closeCaseResult');
        const adminCodeModal = document.getElementById('adminCodeModal');
        const adminCodeInput = document.getElementById('adminCodeInput');
        const confirmAdminCode = document.getElementById('confirmAdminCode');
        const cancelAdminCode = document.getElementById('cancelAdminCode');
        const closeAdminCodeModal = document.getElementById('closeAdminCodeModal');

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ç—Ä–µ–π–¥–∞
        const tradeSection = document.getElementById('tradeSection');
        const createTradeBtn = document.getElementById('createTradeBtn');
        const refreshTrades = document.getElementById('refreshTrades');
        const tradeOffers = document.getElementById('tradeOffers');
        const tradeModal = document.getElementById('tradeModal');
        const tradeModalTitle = document.getElementById('tradeModalTitle');
        const myTradeItems = document.getElementById('myTradeItems');
        const theirTradeItems = document.getElementById('theirTradeItems');
        const myClicksInput = document.getElementById('myClicksInput');
        const theirClicksInput = document.getElementById('theirClicksInput');
        const addMyUpgrade = document.getElementById('addMyUpgrade');
        const addTheirUpgrade = document.getElementById('addTheirUpgrade');
        const tradePlayerInput = document.getElementById('tradePlayerInput');
        const sendTradeOffer = document.getElementById('sendTradeOffer');
        const cancelTrade = document.getElementById('cancelTrade');
        const closeTradeModal = document.getElementById('closeTradeModal');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            // –°–ª—É—à–∞—Ç–µ–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
            auth.onAuthStateChanged(user => {
                if (user) {
                    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª –≤ —Å–∏—Å—Ç–µ–º—É
                    handleUserLogin(user);
                } else {
                    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª –∏–∑ —Å–∏—Å—Ç–µ–º—ã
                    handleUserLogout();
                }
            });

            // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
            loadLeaderboard();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞
            loadChat();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
            loadGameState();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
            checkActiveEvent();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∫–µ–π—Å–æ–≤
            initCasesSystem();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –æ–±–º–µ–Ω–∞
            initTradeSystem();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CPS –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            setInterval(updateCPS, 1000);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏–π –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
            setInterval(checkActiveEvent, 5000);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function handleUserLogin(user) {
            console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª:", user.email);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–¥–º–∏–Ω–∞
            isAdmin = ADMIN_EMAILS.includes(user.email);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            loginBtn.style.display = 'none';
            registerBtn.style.display = 'none';
            logoutBtn.style.display = 'block';
            userDisplay.style.display = 'flex';
            
            if (isAdmin) {
                adminPanelBtn.style.display = 'block';
                adminBadge.style.display = 'inline';
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = 'block';
                });
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadUserData(user.uid);
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π
            loadUpgrades();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∞–¥–º–∏–Ω–∞
            if (isAdmin) {
                loadUserList();
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥—Ä—É–∑–µ–π
            loadFriends();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –æ–±–º–µ–Ω–∞
            loadTradeOffers();
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ö–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function handleUserLogout() {
            console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª");
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º
            if (auth.currentUser) {
                saveGameState();
            }
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
            gameState.clicks = 0;
            gameState.bestScore = 0;
            gameState.clickMultiplier = 1;
            gameState.previousClicks = 0;
            gameState.previousBestScore = 0;
            gameState.previousCPS = 0;
            gameState.clickHistory = [];
            
            // –°–±—Ä–æ—Å —É–ª—É—á—à–µ–Ω–∏–π
            upgrades = {
                totalBonus: 0,
                items: []
            };
            
            // –°–±—Ä–æ—Å –æ–±–º–µ–Ω–∞
            currentTrade = {
                myItems: [],
                myClicks: 0,
                theirItems: [],
                theirClicks: 0,
                targetPlayer: null
            };
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            loginBtn.style.display = 'block';
            registerBtn.style.display = 'block';
            logoutBtn.style.display = 'none';
            userDisplay.style.display = 'none';
            adminPanelBtn.style.display = 'none';
            adminBadge.style.display = 'none';
            adminSection.style.display = 'none';
            changeNickname.style.display = 'none';
            userVerified.style.display = 'none';
            bonusDisplay.style.display = 'none';
            
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = 'none';
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            updateGameDisplay();
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
            loadLeaderboard();
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ö–ª–∏–∫–µ—Ä
            clickArea.addEventListener('click', handleClick);
            
            // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
            loginBtn.addEventListener('click', () => showAuthModal('login'));
            registerBtn.addEventListener('click', () => showAuthModal('register'));
            logoutBtn.addEventListener('click', handleLogout);
            authSubmit.addEventListener('click', handleAuthSubmit);
            authCancel.addEventListener('click', hideAuthModal);
            closeAuthModal.addEventListener('click', hideAuthModal);
            
            // –ù–∏–∫–Ω–µ–π–º
            changeNickname.addEventListener('click', showNicknameModal);
            saveNickname.addEventListener('click', saveNicknameHandler);
            cancelNickname.addEventListener('click', hideNicknameModal);
            closeNicknameModal.addEventListener('click', hideNicknameModal);
            
            // –õ–∏–¥–µ—Ä–±–æ—Ä–¥
            showTop10.addEventListener('click', () => changeLeaderboardLimit(10));
            showTop25.addEventListener('click', () => changeLeaderboardLimit(25));
            showAll.addEventListener('click', () => changeLeaderboardLimit(0));
            
            // –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
            adminPanelBtn.addEventListener('click', toggleAdminPanel);
            refreshUsers.addEventListener('click', loadUserList);
            resetAllScores.addEventListener('click', resetAllScoresHandler);
            addClicksToAll.addEventListener('click', () => showCustomClicksModal('all'));
            deleteInactive.addEventListener('click', deleteInactiveUsers);
            addClicksToOnline.addEventListener('click', () => addClicksToOnlineHandler());
            addMyClicks.addEventListener('click', () => addMyClicksHandler());
            createEvent.addEventListener('click', showEventModal);
            
            // –ú–æ–¥–∞–ª–∫–∏ –∞–¥–º–∏–Ω–∞
            adminSave.addEventListener('click', saveUserChanges);
            adminDelete.addEventListener('click', deleteUser);
            toggleVerified.addEventListener('click', toggleUserVerified);
            adminCancel.addEventListener('click', hideAdminModal);
            closeAdminModal.addEventListener('click', hideAdminModal);
            
            // –ú–æ–¥–∞–ª–∫–∞ —Å–æ–±—ã—Ç–∏–π
            startEvent.addEventListener('click', startEventHandler);
            stopEvent.addEventListener('click', stopEventHandler);
            cancelEvent.addEventListener('click', hideEventModal);
            closeEventModal.addEventListener('click', hideEventModal);
            
            // –ú–æ–¥–∞–ª–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∫–ª–∏–∫–æ–≤
            confirmCustomClicks.addEventListener('click', confirmCustomClicksHandler);
            cancelCustomClicks.addEventListener('click', hideCustomClicksModal);
            closeCustomClicksModal.addEventListener('click', hideCustomClicksModal);
            
            // –ß–∞—Ç
            sendMessage.addEventListener('click', sendChatMessage);
            chatInput.addEventListener('keypress', e => {
                if (e.key === 'Enter') sendChatMessage();
            });
            
            // –î—Ä—É–∑—å—è
            addFriendBtn.addEventListener('click', showFriendsModal);
            refreshFriends.addEventListener('click', loadFriends);
            searchFriend.addEventListener('click', searchFriendHandler);
            cancelFriend.addEventListener('click', hideFriendsModal);
            closeFriendsModal.addEventListener('click', hideFriendsModal);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∫–µ–π—Å–æ–≤
        function initCasesSystem() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–µ–π—Å–æ–≤
            basicCase.addEventListener('click', () => openCase('basic'));
            advancedCase.addEventListener('click', () => openCase('advanced'));
            premiumCase.addEventListener('click', () => openCase('premium'));
            legendaryCase.addEventListener('click', () => openCase('legendary'));
            closeCaseResult.addEventListener('click', hideCaseResult);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–æ–¥–∞ –∞–¥–º–∏–Ω–∞
            confirmAdminCode.addEventListener('click', verifyAdminCode);
            cancelAdminCode.addEventListener('click', hideAdminCodeModal);
            closeAdminCodeModal.addEventListener('click', hideAdminCodeModal);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –æ–±–º–µ–Ω–∞
        function initTradeSystem() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ–±–º–µ–Ω–∞
            createTradeBtn.addEventListener('click', showTradeModal);
            refreshTrades.addEventListener('click', loadTradeOffers);
            addMyUpgrade.addEventListener('click', () => addUpgradeToTrade('my'));
            addTheirUpgrade.addEventListener('click', () => addUpgradeToTrade('their'));
            sendTradeOffer.addEventListener('click', sendTradeOfferHandler);
            cancelTrade.addEventListener('click', hideTradeModal);
            closeTradeModal.addEventListener('click', hideTradeModal);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –≤ –æ–±–º–µ–Ω–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
            myClicksInput.addEventListener('input', updateTradeClicks);
            theirClicksInput.addEventListener('input', updateTradeClicks);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadUpgrades() {
            if (!auth.currentUser) return;
            
            const upgradesRef = database.ref('userUpgrades/' + auth.currentUser.uid);
            upgradesRef.on('value', snapshot => {
                const data = snapshot.val();
                if (data) {
                    upgrades = data;
                    renderUpgradesList();
                    updateBonusDisplay();
                }
            });
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π
        function renderUpgradesList() {
            upgradesList.innerHTML = '<h3 style="margin-bottom: 15px;">–í–∞—à–∏ —É–ª—É—á—à–µ–Ω–∏—è</h3>';
            
            if (upgrades.items && upgrades.items.length > 0) {
                upgrades.items.forEach((upgrade, index) => {
                    const upgradeItem = document.createElement('div');
                    upgradeItem.className = 'upgrade-item';
                    
                    let rarityClass = 'upgrade-rarity-common';
                    if (upgrade.value === 0.2) rarityClass = 'upgrade-rarity-uncommon';
                    else if (upgrade.value === 0.5) rarityClass = 'upgrade-rarity-rare';
                    else if (upgrade.value === 1.0) rarityClass = 'upgrade-rarity-epic';
                    else if (upgrade.value >= 2.0) rarityClass = 'upgrade-rarity-legendary';
                    
                    upgradeItem.innerHTML = `
                        <div>
                            <span class="${rarityClass}">–£–ª—É—á—à–µ–Ω–∏–µ +${upgrade.value}</span>
                        </div>
                        <div>
                            <small>${new Date(upgrade.timestamp).toLocaleDateString('ru-RU')}</small>
                        </div>
                    `;
                    
                    upgradesList.appendChild(upgradeItem);
                });
                
                const totalBonusItem = document.createElement('div');
                totalBonusItem.className = 'upgrade-item';
                totalBonusItem.style.background = 'rgba(253, 187, 45, 0.3)';
                totalBonusItem.innerHTML = `
                    <div><strong>–û–±—â–∏–π –±–æ–Ω—É—Å –∫ –∫–ª–∏–∫—É</strong></div>
                    <div><strong>+${upgrades.totalBonus || 0}</strong></div>
                `;
                upgradesList.appendChild(totalBonusItem);
            } else {
                upgradesList.innerHTML += '<div style="text-align: center; padding: 20px;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —É–ª—É—á—à–µ–Ω–∏–π</div>';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–æ–Ω—É—Å–∞
        function updateBonusDisplay() {
            if (upgrades.totalBonus > 0) {
                bonusValue.textContent = upgrades.totalBonus.toFixed(1);
                bonusDisplay.style.display = 'block';
            } else {
                bonusDisplay.style.display = 'none';
            }
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞
        function openCase(caseType) {
            if (!auth.currentUser) {
                alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –∫–µ–π—Å—ã');
                return;
            }
            
            let casePrice, caseName, caseElement;
            let chances = [];
            
            switch(caseType) {
                case 'basic':
                    casePrice = 250;
                    caseName = '–ë–∞–∑–æ–≤—ã–π –∫–µ–π—Å';
                    caseElement = basicCase;
                    chances = [
                        { value: 0.1, probability: 65 },
                        { value: 0.2, probability: 25 },
                        { value: 0.5, probability: 8 },
                        { value: 1.0, probability: 2 }
                    ];
                    break;
                case 'advanced':
                    casePrice = 750;
                    caseName = '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∫–µ–π—Å';
                    caseElement = advancedCase;
                    chances = [
                        { value: 0.2, probability: 50 },
                        { value: 0.5, probability: 30 },
                        { value: 1.0, probability: 15 },
                        { value: 2.0, probability: 5 }
                    ];
                    break;
                case 'premium':
                    casePrice = 1500;
                    caseName = '–ü—Ä–µ–º–∏—É–º –∫–µ–π—Å';
                    caseElement = premiumCase;
                    chances = [
                        { value: 0.5, probability: 40 },
                        { value: 1.0, probability: 35 },
                        { value: 2.0, probability: 20 },
                        { value: 3.0, probability: 5 }
                    ];
                    break;
                case 'legendary':
                    casePrice = 3000;
                    caseName = '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–µ–π—Å';
                    caseElement = legendaryCase;
                    chances = [
                        { value: 1.0, probability: 30 },
                        { value: 2.0, probability: 40 },
                        { value: 3.0, probability: 25 },
                        { value: 5.0, probability: 5 }
                    ];
                    break;
                default:
                    return;
            }
            
            if (gameState.clicks < casePrice) {
                alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–ª–∏–∫–æ–≤! –ù—É–∂–Ω–æ ${casePrice} –∫–ª–∏–∫–æ–≤.`);
                return;
            }
            
            if (!confirm(`–û—Ç–∫—Ä—ã—Ç—å ${caseName} –∑–∞ ${casePrice} –∫–ª–∏–∫–æ–≤?`)) {
                return;
            }
            
            // –°–ø–∏–Ω –∞–Ω–∏–º–∞—Ü–∏—è
            caseElement.style.opacity = '0.7';
            caseElement.querySelector('button').textContent = '–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è...';
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
            setTimeout(() => {
                // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—ã–ø–∞–≤—à–µ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è
                const random = Math.random() * 100;
                let upgradeValue, rarity, rarityName;
                let cumulativeProbability = 0;
                
                for (let chance of chances) {
                    cumulativeProbability += chance.probability;
                    if (random <= cumulativeProbability) {
                        upgradeValue = chance.value;
                        break;
                    }
                }
                
                // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–¥–∫–æ—Å—Ç–∏
                if (upgradeValue === 0.1) {
                    rarity = 'common';
                    rarityName = '–û–±—ã—á–Ω–æ–µ';
                } else if (upgradeValue === 0.2) {
                    rarity = 'uncommon';
                    rarityName = '–ù–µ–æ–±—ã—á–Ω–æ–µ';
                } else if (upgradeValue === 0.5) {
                    rarity = 'rare';
                    rarityName = '–†–µ–¥–∫–æ–µ';
                } else if (upgradeValue === 1.0) {
                    rarity = 'epic';
                    rarityName = '–≠–ø–∏—á–µ—Å–∫–æ–µ';
                } else if (upgradeValue === 2.0) {
                    rarity = 'epic';
                    rarityName = '–≠–ø–∏—á–µ—Å–∫–æ–µ';
                } else if (upgradeValue === 3.0) {
                    rarity = 'legendary';
                    rarityName = '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ';
                } else if (upgradeValue === 5.0) {
                    rarity = 'legendary';
                    rarityName = '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ';
                }
                
                // –°–ø–∏—Å–∞–Ω–∏–µ –∫–ª–∏–∫–æ–≤
                gameState.clicks -= casePrice;
                updateGameDisplay();
                saveGameState();
                
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏—è
                addUpgrade(upgradeValue, rarity, rarityName);
                
                // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                showCaseResult(upgradeValue, rarity, rarityName, caseName);
                
                // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
                caseElement.style.opacity = '1';
                caseElement.querySelector('button').textContent = '–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å';
            }, 1500);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏—è
        function addUpgrade(value, rarity, rarityName) {
            if (!upgrades.items) {
                upgrades.items = [];
            }
            
            const newUpgrade = {
                value: value,
                rarity: rarity,
                rarityName: rarityName,
                timestamp: Date.now()
            };
            
            upgrades.items.push(newUpgrade);
            upgrades.totalBonus = (upgrades.totalBonus || 0) + value;
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
            if (auth.currentUser) {
                const upgradesRef = database.ref('userUpgrades/' + auth.currentUser.uid);
                upgradesRef.set(upgrades);
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            renderUpgradesList();
            updateBonusDisplay();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
        function showCaseResult(value, rarity, rarityName, caseName) {
            let rarityColor = '#ffffff';
            if (rarity === 'uncommon') rarityColor = '#4CAF50';
            else if (rarity === 'rare') rarityColor = '#2196F3';
            else if (rarity === 'epic') rarityColor = '#9C27B0';
            else if (rarity === 'legendary') rarityColor = '#FF9800';
            
            caseResultTitle.textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${caseName}`;
            caseResultContent.innerHTML = `
                <div style="font-size: 1.5rem; color: ${rarityColor}; margin: 10px 0;">
                    ${rarityName} —É–ª—É—á—à–µ–Ω–∏–µ!
                </div>
                <div style="font-size: 2rem; font-weight: bold; color: #fdbb2d; margin: 15px 0;">
                    +${value} –∫ –∫–ª–∏–∫—É
                </div>
                <div>–¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π –≤–∞—à –∫–ª–∏–∫ –±—É–¥–µ—Ç –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∏–∫–∏!</div>
            `;
            
            caseResultModal.style.display = 'flex';
        }

        // –°–∫—Ä—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
        function hideCaseResult() {
            caseResultModal.style.display = 'none';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–¥–∞ –∞–¥–º–∏–Ω–∞
        function showAdminCodeModal() {
            adminCodeModal.style.display = 'flex';
            adminCodeInput.value = '';
        }

        // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–¥–∞ –∞–¥–º–∏–Ω–∞
        function hideAdminCodeModal() {
            adminCodeModal.style.display = 'none';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –∞–¥–º–∏–Ω–∞
        function verifyAdminCode() {
            const enteredCode = adminCodeInput.value.trim();
            
            if (enteredCode === ADMIN_CONFIRMATION_CODE) {
                hideAdminCodeModal();
                adminSection.style.display = 'block';
                loadUserList();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è!');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±–º–µ–Ω–∞
        function showTradeModal() {
            if (!auth.currentUser) {
                alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–±–º–µ–Ω—ã');
                return;
            }
            
            // –°–±—Ä–æ—Å —Ç–µ–∫—É—â–µ–≥–æ –æ–±–º–µ–Ω–∞
            currentTrade = {
                myItems: [],
                myClicks: 0,
                theirItems: [],
                theirClicks: 0,
                targetPlayer: null
            };
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            myClicksInput.value = '';
            theirClicksInput.value = '';
            tradePlayerInput.value = '';
            updateTradeDisplay();
            
            tradeModal.style.display = 'flex';
        }

        // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±–º–µ–Ω–∞
        function hideTradeModal() {
            tradeModal.style.display = 'none';
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏—è –≤ –æ–±–º–µ–Ω
        function addUpgradeToTrade(side) {
            if (!upgrades.items || upgrades.items.length === 0) {
                alert('–£ –≤–∞—Å –Ω–µ—Ç —É–ª—É—á—à–µ–Ω–∏–π –¥–ª—è –æ–±–º–µ–Ω–∞');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π
            let availableUpgrades = [];
            upgrades.items.forEach((upgrade, index) => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–∏ —É–∂–µ —ç—Ç–æ —É–ª—É—á—à–µ–Ω–∏–µ –≤ –æ–±–º–µ–Ω
                const alreadyAdded = currentTrade.myItems.some(item => 
                    Math.abs(item.value - upgrade.value) < 0.001 && 
                    item.rarity === upgrade.rarity
                );
                
                if (!alreadyAdded) {
                    availableUpgrades.push({
                        index: index,
                        value: upgrade.value,
                        rarity: upgrade.rarity,
                        rarityName: upgrade.rarityName
                    });
                }
            });
            
            if (availableUpgrades.length === 0) {
                alert('–í—Å–µ –≤–∞—à–∏ —É–ª—É—á—à–µ–Ω–∏—è —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –æ–±–º–µ–Ω');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —É–ª—É—á—à–µ–Ω–∏—è
            let upgradeList = "–í—ã–±–µ—Ä–∏—Ç–µ —É–ª—É—á—à–µ–Ω–∏–µ (–≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä):\n";
            availableUpgrades.forEach((upg, i) => {
                upgradeList += `${i + 1}. +${upg.value} (${upg.rarityName})\n`;
            });
            
            const choice = parseInt(prompt(upgradeList));
            if (isNaN(choice) || choice < 1 || choice > availableUpgrades.length) {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä');
                return;
            }
            
            const selectedUpgrade = availableUpgrades[choice - 1];
            
            if (side === 'my') {
                currentTrade.myItems.push({
                    value: selectedUpgrade.value,
                    rarity: selectedUpgrade.rarity,
                    rarityName: selectedUpgrade.rarityName
                });
            } else {
                currentTrade.theirItems.push({
                    value: selectedUpgrade.value,
                    rarity: selectedUpgrade.rarity,
                    rarityName: selectedUpgrade.rarityName
                });
            }
            
            updateTradeDisplay();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –≤ –æ–±–º–µ–Ω–µ
        function updateTradeClicks() {
            const myClicks = parseInt(myClicksInput.value) || 0;
            const theirClicks = parseInt(theirClicksInput.value) || 0;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            currentTrade.myClicks = Math.max(0, myClicks);
            currentTrade.theirClicks = Math.max(0, theirClicks);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞
            myClicksInput.value = currentTrade.myClicks;
            theirClicksInput.value = currentTrade.theirClicks;
            
            updateTradeDisplay();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±–º–µ–Ω–∞
        function updateTradeDisplay() {
            // –û—á–∏—Å—Ç–∫–∞ —Å–ø–∏—Å–∫–æ–≤
            myTradeItems.innerHTML = '';
            theirTradeItems.innerHTML = '';
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∞—à–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
            currentTrade.myItems.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'trade-item';
                itemElement.innerHTML = `
                    <span>+${item.value} (${item.rarityName})</span>
                    <button onclick="removeTradeItem('my', ${index})">√ó</button>
                `;
                myTradeItems.appendChild(itemElement);
            });
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∞—à–∏—Ö –∫–ª–∏–∫–æ–≤
            if (currentTrade.myClicks > 0) {
                const clicksElement = document.createElement('div');
                clicksElement.className = 'trade-item';
                clicksElement.innerHTML = `
                    <span>${currentTrade.myClicks} –∫–ª–∏–∫–æ–≤</span>
                    <button onclick="removeTradeClicks('my')">√ó</button>
                `;
                myTradeItems.appendChild(clicksElement);
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
            currentTrade.theirItems.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'trade-item';
                itemElement.innerHTML = `
                    <span>+${item.value} (${item.rarityName})</span>
                    <button onclick="removeTradeItem('their', ${index})">√ó</button>
                `;
                theirTradeItems.appendChild(itemElement);
            });
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
            if (currentTrade.theirClicks > 0) {
                const clicksElement = document.createElement('div');
                clicksElement.className = 'trade-item';
                clicksElement.innerHTML = `
                    <span>${currentTrade.theirClicks} –∫–ª–∏–∫–æ–≤</span>
                    <button onclick="removeTradeClicks('their')">√ó</button>
                `;
                theirTradeItems.appendChild(clicksElement);
            }
            
            // –ï—Å–ª–∏ —Å–ø–∏—Å–∫–∏ –ø—É—Å—Ç—ã–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (myTradeItems.children.length === 0) {
                myTradeItems.innerHTML = '<div style="text-align: center; padding: 10px; opacity: 0.7;">–ü—É—Å—Ç–æ</div>';
            }
            
            if (theirTradeItems.children.length === 0) {
                theirTradeItems.innerHTML = '<div style="text-align: center; padding: 10px; opacity: 0.7;">–ü—É—Å—Ç–æ</div>';
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ –∏–∑ –æ–±–º–µ–Ω–∞
        function removeTradeItem(side, index) {
            if (side === 'my') {
                currentTrade.myItems.splice(index, 1);
            } else {
                currentTrade.theirItems.splice(index, 1);
            }
            updateTradeDisplay();
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –∏–∑ –æ–±–º–µ–Ω–∞
        function removeTradeClicks(side) {
            if (side === 'my') {
                currentTrade.myClicks = 0;
                myClicksInput.value = '';
            } else {
                currentTrade.theirClicks = 0;
                theirClicksInput.value = '';
            }
            updateTradeDisplay();
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–±–º–µ–Ω–∞
        function sendTradeOfferHandler() {
            const targetPlayerName = tradePlayerInput.value.trim();
            if (!targetPlayerName) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞ –¥–ª—è –æ–±–º–µ–Ω–∞');
                return;
            }
            
            if (currentTrade.myItems.length === 0 && currentTrade.myClicks === 0) {
                alert('–í—ã –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç–µ –Ω–∏—á–µ–≥–æ –¥–ª—è –æ–±–º–µ–Ω–∞');
                return;
            }
            
            if (currentTrade.theirItems.length === 0 && currentTrade.theirClicks === 0) {
                alert('–í—ã –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç–µ –Ω–∏—á–µ–≥–æ –¥–ª—è –æ–±–º–µ–Ω–∞');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–∏—Ö –∫–ª–∏–∫–æ–≤
            if (currentTrade.myClicks > gameState.clicks) {
                alert('–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–ª–∏–∫–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –æ–±–º–µ–Ω–∞');
                return;
            }
            
            // –ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–∞ –ø–æ –∏–º–µ–Ω–∏
            const usersRef = database.ref('users');
            usersRef.once('value').then(snapshot => {
                const users = snapshot.val();
                let targetUser = null;
                
                for (let userId in users) {
                    if (userId === auth.currentUser.uid) continue;
                    
                    const userNickname = users[userId].nickname || users[userId].email.split('@')[0];
                    if (userNickname.toLowerCase() === targetPlayerName.toLowerCase()) {
                        targetUser = {
                            id: userId,
                            ...users[userId]
                        };
                        break;
                    }
                }
                
                if (!targetUser) {
                    alert('–ò–≥—Ä–æ–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–±–º–µ–Ω–∞
                const tradeRef = database.ref('trades').push();
                const tradeData = {
                    fromUserId: auth.currentUser.uid,
                    fromUserName: userName.textContent,
                    toUserId: targetUser.id,
                    toUserName: targetUser.nickname || targetUser.email.split('@')[0],
                    myItems: currentTrade.myItems.map(item => ({
                        value: item.value,
                        rarity: item.rarity,
                        rarityName: item.rarityName
                    })),
                    myClicks: currentTrade.myClicks,
                    theirItems: currentTrade.theirItems.map(item => ({
                        value: item.value,
                        rarity: item.rarity,
                        rarityName: item.rarityName
                    })),
                    theirClicks: currentTrade.theirClicks,
                    status: 'pending',
                    timestamp: Date.now()
                };
                
                tradeRef.set(tradeData).then(() => {
                    alert('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–±–º–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
                    hideTradeModal();
                    loadTradeOffers();
                }).catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±–º–µ–Ω–∞:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–±–º–µ–Ω–∞');
                });
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –æ–±–º–µ–Ω–∞
        function loadTradeOffers() {
            if (!auth.currentUser) return;
            
            const tradesRef = database.ref('trades');
            tradesRef.on('value', snapshot => {
                const trades = snapshot.val();
                tradeOffers.innerHTML = '';
                
                if (trades) {
                    Object.keys(trades).forEach(tradeId => {
                        const trade = trades[tradeId];
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ–±–º–µ–Ω—ã
                        if (trade.fromUserId === auth.currentUser.uid || trade.toUserId === auth.currentUser.uid) {
                            addTradeOfferToList(tradeId, trade);
                        }
                    });
                } else {
                    tradeOffers.innerHTML = '<div style="text-align: center; padding: 20px;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –æ–±–º–µ–Ω–∞</div>';
                }
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–±–º–µ–Ω–∞ –≤ —Å–ø–∏—Å–æ–∫
        function addTradeOfferToList(tradeId, trade) {
            const isOutgoing = trade.fromUserId === auth.currentUser.uid;
            const otherUserName = isOutgoing ? trade.toUserName : trade.fromUserName;
            
            const tradeElement = document.createElement('div');
            tradeElement.className = 'trade-offer';
            tradeElement.id = `trade-${tradeId}`;
            
            let tradeInfo = `
                <div class="trade-offer-info">
                    <strong>${isOutgoing ? '–ò—Å—Ö–æ–¥—è—â–µ–µ' : '–í—Ö–æ–¥—è—â–µ–µ'} –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</strong><br>
                    <small>–° –∏–≥—Ä–æ–∫–æ–º: ${otherUserName}</small><br>
                    <small>–°—Ç–∞—Ç—É—Å: ${getTradeStatusText(trade.status)}</small>
                </div>
            `;
            
            if (trade.status === 'pending') {
                if (isOutgoing) {
                    tradeInfo += `
                        <div class="trade-offer-actions">
                            <button onclick="cancelTradeOffer('${tradeId}')">–û—Ç–º–µ–Ω–∏—Ç—å</button>
                        </div>
                    `;
                } else {
                    tradeInfo += `
                        <div class="trade-offer-actions">
                            <button onclick="acceptTradeOffer('${tradeId}')">–ü—Ä–∏–Ω—è—Ç—å</button>
                            <button onclick="rejectTradeOffer('${tradeId}')">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                        </div>
                    `;
                }
            }
            
            tradeElement.innerHTML = tradeInfo;
            tradeOffers.appendChild(tradeElement);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ–±–º–µ–Ω–∞
        function getTradeStatusText(status) {
            switch(status) {
                case 'pending': return '–û–∂–∏–¥–∞–Ω–∏–µ';
                case 'accepted': return '–ü—Ä–∏–Ω—è—Ç';
                case 'rejected': return '–û—Ç–∫–ª–æ–Ω–µ–Ω';
                case 'cancelled': return '–û—Ç–º–µ–Ω–µ–Ω';
                default: return status;
            }
        }

        // –ü—Ä–∏–Ω—è—Ç–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–±–º–µ–Ω–∞
        function acceptTradeOffer(tradeId) {
            const tradeRef = database.ref('trades/' + tradeId);
            tradeRef.once('value').then(snapshot => {
                const trade = snapshot.val();
                
                if (!trade || trade.status !== 'pending') {
                    alert('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–±–º–µ–Ω–∞ –±–æ–ª—å—à–µ –Ω–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ');
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –ø–æ–ª—É—á–∞—Ç–µ–ª—å
                if (trade.toUserId !== auth.currentUser.uid) {
                    alert('–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø—Ä–∏–Ω—è—Ç—å —ç—Ç–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–±–º–µ–Ω–∞');
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ —É –æ–±–æ–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
                const fromUserRef = database.ref('users/' + trade.fromUserId);
                const toUserRef = database.ref('users/' + trade.toUserId);
                
                Promise.all([
                    fromUserRef.once('value'),
                    toUserRef.once('value'),
                    database.ref('userUpgrades/' + trade.fromUserId).once('value'),
                    database.ref('userUpgrades/' + trade.toUserId).once('value')
                ]).then(([fromUserSnap, toUserSnap, fromUpgradesSnap, toUpgradesSnap]) => {
                    const fromUser = fromUserSnap.val();
                    const toUser = toUserSnap.val();
                    const fromUpgrades = fromUpgradesSnap.val() || { items: [], totalBonus: 0 };
                    const toUpgrades = toUpgradesSnap.val() || { items: [], totalBonus: 0 };
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∏–∫–æ–≤
                    if (fromUser.clicks < trade.myClicks) {
                        alert('–£ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–ª–∏–∫–æ–≤ –¥–ª—è –æ–±–º–µ–Ω–∞');
                        return Promise.reject('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–ª–∏–∫–æ–≤ —É –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è');
                    }
                    
                    if (toUser.clicks < trade.theirClicks) {
                        alert('–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–ª–∏–∫–æ–≤ –¥–ª—è –æ–±–º–µ–Ω–∞');
                        return Promise.reject('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–ª–∏–∫–æ–≤ —É –ø–æ–ª—É—á–∞—Ç–µ–ª—è');
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π —É –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
                    const fromUpgradesCopy = [...fromUpgrades.items];
                    let fromBonusToRemove = 0;
                    
                    for (let tradeItem of trade.myItems) {
                        // –ò—â–µ–º —É–ª—É—á—à–µ–Ω–∏–µ —Å —Ç–∞–∫–∏–º –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ–º
                        const upgradeIndex = fromUpgradesCopy.findIndex(upg => 
                            Math.abs(upg.value - tradeItem.value) < 0.001 && 
                            upg.rarity === tradeItem.rarity
                        );
                        
                        if (upgradeIndex === -1) {
                            alert('–£ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –Ω–µ—Ç –æ–¥–Ω–æ–≥–æ –∏–∑ —É–ª—É—á—à–µ–Ω–∏–π –¥–ª—è –æ–±–º–µ–Ω–∞');
                            return Promise.reject('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–ª—É—á—à–µ–Ω–∏–π —É –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è');
                        }
                        
                        // –£–¥–∞–ª—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ
                        const removedUpgrade = fromUpgradesCopy.splice(upgradeIndex, 1)[0];
                        fromBonusToRemove += removedUpgrade.value;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π —É –ø–æ–ª—É—á–∞—Ç–µ–ª—è
                    const toUpgradesCopy = [...toUpgrades.items];
                    let toBonusToRemove = 0;
                    
                    for (let tradeItem of trade.theirItems) {
                        // –ò—â–µ–º —É–ª—É—á—à–µ–Ω–∏–µ —Å —Ç–∞–∫–∏–º –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ–º
                        const upgradeIndex = toUpgradesCopy.findIndex(upg => 
                            Math.abs(upg.value - tradeItem.value) < 0.001 && 
                            upg.rarity === tradeItem.rarity
                        );
                        
                        if (upgradeIndex === -1) {
                            alert('–£ –≤–∞—Å –Ω–µ—Ç –æ–¥–Ω–æ–≥–æ –∏–∑ —É–ª—É—á—à–µ–Ω–∏–π –¥–ª—è –æ–±–º–µ–Ω–∞');
                            return Promise.reject('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–ª—É—á—à–µ–Ω–∏–π —É –ø–æ–ª—É—á–∞—Ç–µ–ª—è');
                        }
                        
                        // –£–¥–∞–ª—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ
                        const removedUpgrade = toUpgradesCopy.splice(upgradeIndex, 1)[0];
                        toBonusToRemove += removedUpgrade.value;
                    }
                    
                    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±–º–µ–Ω–∞
                    // 1. –û–±–º–µ–Ω –∫–ª–∏–∫–∞–º–∏
                    const fromNewClicks = fromUser.clicks - trade.myClicks + trade.theirClicks;
                    const toNewClicks = toUser.clicks - trade.theirClicks + trade.myClicks;
                    
                    // 2. –û–±–º–µ–Ω —É–ª—É—á—à–µ–Ω–∏—è–º–∏
                    // –î–æ–±–∞–≤–ª—è–µ–º —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–ª—É—á–∞—Ç–µ–ª—é (–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è)
                    trade.myItems.forEach(tradeItem => {
                        toUpgradesCopy.push({
                            value: tradeItem.value,
                            rarity: tradeItem.rarity,
                            rarityName: tradeItem.rarityName,
                            timestamp: Date.now()
                        });
                    });
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —É–ª—É—á—à–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é (–æ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è)
                    trade.theirItems.forEach(tradeItem => {
                        fromUpgradesCopy.push({
                            value: tradeItem.value,
                            rarity: tradeItem.rarity,
                            rarityName: tradeItem.rarityName,
                            timestamp: Date.now()
                        });
                    });
                    
                    // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –±–æ–Ω—É—Å—ã
                    const fromNewBonus = fromUpgradesCopy.reduce((sum, upg) => sum + upg.value, 0);
                    const toNewBonus = toUpgradesCopy.reduce((sum, upg) => sum + upg.value, 0);
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ
                    return Promise.all([
                        fromUserRef.update({ 
                            clicks: Math.max(0, fromNewClicks),
                            bestScore: Math.max(fromUser.bestScore, Math.max(0, fromNewClicks))
                        }),
                        toUserRef.update({ 
                            clicks: Math.max(0, toNewClicks),
                            bestScore: Math.max(toUser.bestScore, Math.max(0, toNewClicks))
                        }),
                        database.ref('userUpgrades/' + trade.fromUserId).set({
                            items: fromUpgradesCopy,
                            totalBonus: fromNewBonus
                        }),
                        database.ref('userUpgrades/' + trade.toUserId).set({
                            items: toUpgradesCopy,
                            totalBonus: toNewBonus
                        }),
                        tradeRef.update({ status: 'accepted' })
                    ]);
                }).then(() => {
                    alert('–û–±–º–µ–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!');
                    loadTradeOffers();
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                    if (auth.currentUser) {
                        loadUserData(auth.currentUser.uid);
                        loadUpgrades();
                    }
                }).catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–º–µ–Ω–µ:', error);
                    if (typeof error === 'string') {
                        alert(error);
                    } else {
                        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–±–º–µ–Ω–∞');
                    }
                });
            });
        }

        // –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–±–º–µ–Ω–∞
        function rejectTradeOffer(tradeId) {
            if (!confirm('–û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–±–º–µ–Ω–∞?')) return;
            
            const tradeRef = database.ref('trades/' + tradeId);
            tradeRef.update({ status: 'rejected' }).then(() => {
                alert('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–±–º–µ–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ');
                loadTradeOffers();
            });
        }

        // –û—Ç–º–µ–Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–±–º–µ–Ω–∞
        function cancelTradeOffer(tradeId) {
            if (!confirm('–û—Ç–º–µ–Ω–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–±–º–µ–Ω–∞?')) return;
            
            const tradeRef = database.ref('trades/' + tradeId);
            tradeRef.update({ status: 'cancelled' }).then(() => {
                alert('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–±–º–µ–Ω–∞ –æ—Ç–º–µ–Ω–µ–Ω–æ');
                loadTradeOffers();
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ —Å —É—á–µ—Ç–æ–º —É–ª—É—á—à–µ–Ω–∏–π
        function handleClick() {
            if (isBlocked) return;
            
            const now = Date.now();
            clickTimestamps.push(now);
            
            // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∫–ª–∏–∫–æ–≤ (—Å—Ç–∞—Ä—à–µ 1 —Å–µ–∫—É–Ω–¥—ã)
            clickTimestamps = clickTimestamps.filter(timestamp => now - timestamp < 1000);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ CPS
            currentCPS = clickTimestamps.length;
            if (currentCPS > MAX_CPS) {
                blockUser();
                return;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã —Å —É—á–µ—Ç–æ–º —É–ª—É—á—à–µ–Ω–∏–π
            const baseClickValue = 1 * gameState.clickMultiplier;
            const upgradeBonus = upgrades.totalBonus || 0;
            const clickValue = baseClickValue + upgradeBonus;
            
            gameState.clicks += clickValue;
            
            if (gameState.clicks > gameState.bestScore) {
                gameState.bestScore = gameState.clicks;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            updateGameDisplay();
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            saveGameState();
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–ª–∏–∫–∞
            animateClick();
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–æ–¥–∞
        function toggleAdminPanel() {
            if (!isAdmin) {
                alert('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞');
                return;
            }
            
            // –ï—Å–ª–∏ –∞–¥–º–∏–Ω, –Ω–æ –∫–æ–¥ –µ—â–µ –Ω–µ –≤–≤–µ–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            if (adminSection.style.display === 'none' || !adminSection.style.display) {
                showAdminCodeModal();
            } else {
                adminSection.style.display = 'none';
            }
        }

        // –°–±—Ä–æ—Å –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ —É–ª—É—á—à–µ–Ω–∏–π
        function resetAllScoresHandler() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ–±–Ω—É–ª–∏—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                return;
            }
            
            const usersRef = database.ref('users');
            const upgradesRef = database.ref('userUpgrades');
            
            Promise.all([
                usersRef.once('value'),
                upgradesRef.once('value')
            ]).then(([usersSnapshot, upgradesSnapshot]) => {
                const usersUpdates = {};
                const upgradesUpdates = {};
                
                // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const users = usersSnapshot.val();
                if (users) {
                    for (let userId in users) {
                        usersUpdates[`${userId}/clicks`] = 0;
                        usersUpdates[`${userId}/bestScore`] = 0;
                    }
                }
                
                // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π
                const upgrades = upgradesSnapshot.val();
                if (upgrades) {
                    for (let userId in upgrades) {
                        upgradesUpdates[`${userId}/totalBonus`] = 0;
                        upgradesUpdates[`${userId}/items`] = [];
                    }
                }
                
                // –í—ã–ø–æ–ª–Ω—è–µ–º –≤—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                return Promise.all([
                    usersUpdates ? usersRef.update(usersUpdates) : Promise.resolve(),
                    upgradesUpdates ? upgradesRef.update(upgradesUpdates) : Promise.resolve()
                ]);
            }).then(() => {
                alert('–í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è –æ–±–Ω—É–ª–µ–Ω—ã');
                loadUserList();
                loadLeaderboard();
                
                // –°–±—Ä–æ—Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                if (auth.currentUser) {
                    gameState.clicks = 0;
                    gameState.bestScore = 0;
                    upgrades.totalBonus = 0;
                    upgrades.items = [];
                    updateGameDisplay();
                    renderUpgradesList();
                    updateBonusDisplay();
                    saveGameState();
                }
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω—É–ª–µ–Ω–∏–∏:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω—É–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö');
            });
        }

        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–µ –∫–ª–∏–∫–∏
        function blockUser() {
            isBlocked = true;
            clickArea.classList.add('blocked');
            blockedOverlay.style.display = 'flex';
            cpsWarning.textContent = `–°–õ–ò–®–ö–û–ú –ë–´–°–¢–†–û! –ü–æ–¥–æ–∂–¥–∏—Ç–µ ${MAX_CPS/2} —Å–µ–∫—É–Ω–¥`;
            
            blockTimeout = setTimeout(() => {
                isBlocked = false;
                clickArea.classList.remove('blocked');
                blockedOverlay.style.display = 'none';
                cpsWarning.textContent = '';
                clickTimestamps = [];
            }, (MAX_CPS/2) * 1000);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CPS
        function updateCPS() {
            const now = Date.now();
            clickTimestamps = clickTimestamps.filter(timestamp => now - timestamp < 1000);
            currentCPS = clickTimestamps.length;
            
            cpsValue.textContent = currentCPS;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ CPS
            const cpsPercentage = Math.min((currentCPS / MAX_CPS) * 100, 100);
            cpsFill.style.width = `${cpsPercentage}%`;
            
            // –¶–≤–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç CPS
            if (currentCPS > MAX_CPS * 0.8) {
                cpsFill.style.background = 'linear-gradient(90deg, #FFC107, #F44336)';
            } else if (currentCPS > MAX_CPS * 0.5) {
                cpsFill.style.background = 'linear-gradient(90deg, #4CAF50, #FFC107)';
            } else {
                cpsFill.style.background = 'linear-gradient(90deg, #4CAF50, #4CAF50)';
            }
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –∫–ª–∏–∫–∞
        function animateClick() {
            clickText.style.transform = 'scale(1.1)';
            setTimeout(() => {
                clickText.style.transform = 'scale(1)';
            }, 100);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–≥—Ä—ã
        function updateGameDisplay() {
            clickCount.textContent = Math.floor(gameState.clicks);
            bestScore.textContent = Math.floor(gameState.bestScore);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        function loadGameState() {
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ Firebase
            if (auth.currentUser) {
                loadUserData(auth.currentUser.uid);
            } else {
                // –ò–Ω–∞—á–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage
                const savedState = localStorage.getItem('clickerGameState');
                if (savedState) {
                    const parsedState = JSON.parse(savedState);
                    gameState.clicks = parsedState.clicks || 0;
                    gameState.bestScore = parsedState.bestScore || 0;
                    updateGameDisplay();
                }
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        function saveGameState() {
            if (auth.currentUser) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
                const userRef = database.ref('users/' + auth.currentUser.uid);
                userRef.update({
                    clicks: Math.floor(gameState.clicks),
                    bestScore: Math.floor(gameState.bestScore),
                    lastActive: Date.now()
                });
            } else {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                localStorage.setItem('clickerGameState', JSON.stringify({
                    clicks: gameState.clicks,
                    bestScore: gameState.bestScore
                }));
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadUserData(userId) {
            const userRef = database.ref('users/' + userId);
            userRef.on('value', snapshot => {
                const userData = snapshot.val();
                if (userData) {
                    gameState.clicks = userData.clicks || 0;
                    gameState.bestScore = userData.bestScore || 0;
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    userName.textContent = userData.nickname || userData.email.split('@')[0];
                    userAvatar.textContent = (userData.nickname || userData.email[0]).toUpperCase();
                    
                    if (userData.verified) {
                        userVerified.style.display = 'inline';
                    } else {
                        userVerified.style.display = 'none';
                    }
                    
                    changeNickname.style.display = 'block';
                    
                    updateGameDisplay();
                }
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
        function loadLeaderboard() {
            const usersRef = database.ref('users');
            usersRef.orderByChild('bestScore').limitToLast(leaderboardLimit === 0 ? 1000 : leaderboardLimit).on('value', snapshot => {
                const users = snapshot.val();
                const leaderboardArray = [];
                
                for (let userId in users) {
                    if (users[userId].bestScore > 0) {
                        leaderboardArray.push({
                            id: userId,
                            email: users[userId].email,
                            nickname: users[userId].nickname,
                            clicks: users[userId].clicks || 0,
                            bestScore: users[userId].bestScore || 0,
                            verified: users[userId].verified || false
                        });
                    }
                }
                
                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ bestScore (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
                leaderboardArray.sort((a, b) => b.bestScore - a.bestScore);
                
                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π
                if (leaderboardLimit > 0) {
                    leaderboardArray.splice(leaderboardLimit);
                }
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
                renderLeaderboard(leaderboardArray);
            });
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
        function renderLeaderboard(users) {
            leaderboard.innerHTML = '';
            
            users.forEach((user, index) => {
                const isCurrentUser = auth.currentUser && user.id === auth.currentUser.uid;
                const listItem = document.createElement('li');
                listItem.className = `leaderboard-item ${isCurrentUser ? 'current-user' : ''}`;
                
                listItem.innerHTML = `
                    <div class="rank">${index + 1}</div>
                    <div class="player-name">
                        <span>${user.nickname || user.email.split('@')[0]}</span>
                        ${user.verified ? '<span class="verified-badge">‚úì</span>' : ''}
                        ${isCurrentUser ? '<span style="color: #fdbb2d; margin-left: 5px;">(–í—ã)</span>' : ''}
                    </div>
                    <div class="player-score">${Math.floor(user.bestScore)}</div>
                `;
                
                if (isAdmin) {
                    const adminBtn = document.createElement('button');
                    adminBtn.textContent = '–†–µ–¥.';
                    adminBtn.style.padding = '5px 10px';
                    adminBtn.style.fontSize = '0.7rem';
                    adminBtn.addEventListener('click', () => editUser(user));
                    listItem.appendChild(adminBtn);
                }
                
                leaderboard.appendChild(listItem);
            });
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            if (users.length === 0) {
                const listItem = document.createElement('li');
                listItem.className = 'leaderboard-item';
                listItem.innerHTML = '<div style="text-align: center; width: 100%;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';
                leaderboard.appendChild(listItem);
            }
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
        function changeLeaderboardLimit(limit) {
            leaderboardLimit = limit;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
            showTop10.classList.remove('active');
            showTop25.classList.remove('active');
            showAll.classList.remove('active');
            
            if (limit === 10) showTop10.classList.add('active');
            if (limit === 25) showTop25.classList.add('active');
            if (limit === 0) showAll.classList.add('active');
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
            loadLeaderboard();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        function showAuthModal(type) {
            authModal.style.display = 'flex';
            if (type === 'login') {
                authModalTitle.textContent = '–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç';
                authSubmit.textContent = '–í–æ–π—Ç–∏';
            } else {
                authModalTitle.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞';
                authSubmit.textContent = '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
            }
            
            currentAction = type;
        }

        // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        function hideAuthModal() {
            authModal.style.display = 'none';
            authEmail.value = '';
            authPassword.value = '';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        function handleAuthSubmit() {
            const email = authEmail.value;
            const password = authPassword.value;
            
            if (!email || !password) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            if (currentAction === 'login') {
                auth.signInWithEmailAndPassword(email, password)
                    .then(() => {
                        hideAuthModal();
                    })
                    .catch(error => {
                        alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message);
                    });
            } else {
                auth.createUserWithEmailAndPassword(email, password)
                    .then(userCredential => {
                        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
                        const user = userCredential.user;
                        const userRef = database.ref('users/' + user.uid);
                        
                        userRef.set({
                            email: email,
                            nickname: email.split('@')[0],
                            clicks: 0,
                            bestScore: 0,
                            registered: Date.now(),
                            lastActive: Date.now(),
                            verified: false
                        });
                        
                        hideAuthModal();
                        showNicknameModal();
                    })
                    .catch(error => {
                        alert('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message);
                    });
            }
        }

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function handleLogout() {
            auth.signOut();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∏–∫–Ω–µ–π–º–∞
        function showNicknameModal() {
            if (auth.currentUser) {
                const userRef = database.ref('users/' + auth.currentUser.uid);
                userRef.once('value').then(snapshot => {
                    const userData = snapshot.val();
                    nicknameInput.value = userData.nickname || '';
                    nicknameModal.style.display = 'flex';
                });
            }
        }

        // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∏–∫–Ω–µ–π–º–∞
        function hideNicknameModal() {
            nicknameModal.style.display = 'none';
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∏–∫–Ω–µ–π–º–∞
        function saveNicknameHandler() {
            const nickname = nicknameInput.value.trim();
            
            if (!nickname) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º');
                return;
            }
            
            if (nickname.length > 15) {
                alert('–ù–∏–∫–Ω–µ–π–º –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ 15 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }
            
            if (auth.currentUser) {
                const userRef = database.ref('users/' + auth.currentUser.uid);
                userRef.update({
                    nickname: nickname
                }).then(() => {
                    hideNicknameModal();
                    userName.textContent = nickname;
                    userAvatar.textContent = nickname[0].toUpperCase();
                });
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function loadUserList() {
            if (!isAdmin) return;
            
            const usersRef = database.ref('users');
            usersRef.once('value').then(snapshot => {
                const users = snapshot.val();
                const usersArray = [];
                
                for (let userId in users) {
                    usersArray.push({
                        id: userId,
                        email: users[userId].email,
                        nickname: users[userId].nickname,
                        clicks: users[userId].clicks || 0,
                        bestScore: users[userId].bestScore || 0,
                        verified: users[userId].verified || false,
                        lastActive: users[userId].lastActive || 0
                    });
                }
                
                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                usersArray.sort((a, b) => b.lastActive - a.lastActive);
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                renderUserList(usersArray);
            });
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function renderUserList(users) {
            userList.innerHTML = '';
            
            users.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                
                const lastActive = user.lastActive ? new Date(user.lastActive).toLocaleDateString('ru-RU') : '–ù–∏–∫–æ–≥–¥–∞';
                
                userItem.innerHTML = `
                    <div class="user-info">
                        <div>${user.nickname || user.email.split('@')[0]} ${user.verified ? '<span class="verified-badge">‚úì</span>' : ''}</div>
                        <div style="font-size: 0.8rem; opacity: 0.7;">–ö–ª–∏–∫–∏: ${user.clicks} | –õ—É—á—à–∏–π: ${user.bestScore} | –ê–∫—Ç–∏–≤–µ–Ω: ${lastActive}</div>
                    </div>
                    <div class="user-actions">
                        <button class="edit-user">–†–µ–¥.</button>
                    </div>
                `;
                
                const editBtn = userItem.querySelector('.edit-user');
                editBtn.addEventListener('click', () => editUser(user));
                
                userList.appendChild(userItem);
            });
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function editUser(user) {
            selectedUser = user;
            adminModalTitle.textContent = `–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: ${user.nickname || user.email.split('@')[0]}`;
            adminUserInfo.innerHTML = `
                <div>Email: ${user.email}</div>
                <div>–ù–∏–∫–Ω–µ–π–º: ${user.nickname || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}</div>
                <div>–ö–ª–∏–∫–∏: ${user.clicks}</div>
                <div>–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${user.bestScore}</div>
                <div>–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω: ${user.verified ? '–î–∞' : '–ù–µ—Ç'}</div>
            `;
            adminClicksInput.value = user.clicks;
            adminBestScoreInput.value = user.bestScore;
            adminModal.style.display = 'flex';
        }

        // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–¥–º–∏–Ω–∞
        function hideAdminModal() {
            adminModal.style.display = 'none';
            selectedUser = null;
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function saveUserChanges() {
            if (!selectedUser) return;
            
            const newClicks = parseInt(adminClicksInput.value) || 0;
            const newBestScore = parseInt(adminBestScoreInput.value) || 0;
            
            const userRef = database.ref('users/' + selectedUser.id);
            userRef.update({
                clicks: newClicks,
                bestScore: newBestScore
            }).then(() => {
                alert('–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
                hideAdminModal();
                loadUserList();
                loadLeaderboard();
            });
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function deleteUser() {
            if (!selectedUser || !confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${selectedUser.email}?`)) {
                return;
            }
            
            const userRef = database.ref('users/' + selectedUser.id);
            userRef.remove().then(() => {
                alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω');
                hideAdminModal();
                loadUserList();
                loadLeaderboard();
            });
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function toggleUserVerified() {
            if (!selectedUser) return;
            
            const userRef = database.ref('users/' + selectedUser.id);
            userRef.update({
                verified: !selectedUser.verified
            }).then(() => {
                alert(`–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è ${!selectedUser.verified ? '–≤–∫–ª—é—á–µ–Ω–∞' : '–æ—Ç–∫–ª—é—á–µ–Ω–∞'}`);
                hideAdminModal();
                loadUserList();
                loadLeaderboard();
            });
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function deleteInactiveUsers() {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –±—ã–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã –±–æ–ª–µ–µ 30 –¥–Ω–µ–π?')) {
                return;
            }
            
            const monthAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
            const usersRef = database.ref('users');
            
            usersRef.once('value').then(snapshot => {
                const users = snapshot.val();
                let deletedCount = 0;
                
                for (let userId in users) {
                    if (!users[userId].lastActive || users[userId].lastActive < monthAgo) {
                        usersRef.child(userId).remove();
                        deletedCount++;
                    }
                }
                
                alert(`–£–¥–∞–ª–µ–Ω–æ ${deletedCount} –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
                loadUserList();
                loadLeaderboard();
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∫–ª–∏–∫–æ–≤
        function showCustomClicksModal(type) {
            currentAction = type;
            
            if (type === 'all') {
                customClicksTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–∫–∏ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º';
            } else if (type === 'online') {
                customClicksTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–∫–∏ –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º';
            } else if (type === 'me') {
                customClicksTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–∫–∏ —Å–µ–±–µ';
            }
            
            customClicksModal.style.display = 'flex';
        }

        // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∫–ª–∏–∫–æ–≤
        function hideCustomClicksModal() {
            customClicksModal.style.display = 'none';
            customClicksInput.value = '';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∫–ª–∏–∫–æ–≤
        function confirmCustomClicksHandler() {
            const clicksToAdd = parseInt(customClicksInput.value) || 0;
            
            if (clicksToAdd <= 0) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ');
                return;
            }
            
            if (currentAction === 'all') {
                addClicksToAllUsers(clicksToAdd);
            } else if (currentAction === 'online') {
                addClicksToOnlineUsers(clicksToAdd);
            } else if (currentAction === 'me') {
                addClicksToMe(clicksToAdd);
            }
            
            hideCustomClicksModal();
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
        function addClicksToAllUsers(clicksToAdd) {
            const usersRef = database.ref('users');
            usersRef.once('value').then(snapshot => {
                const users = snapshot.val();
                const updates = {};
                
                for (let userId in users) {
                    const currentClicks = users[userId].clicks || 0;
                    const currentBest = users[userId].bestScore || 0;
                    const newClicks = currentClicks + clicksToAdd;
                    const newBest = Math.max(currentBest, newClicks);
                    
                    updates[`${userId}/clicks`] = newClicks;
                    updates[`${userId}/bestScore`] = newBest;
                }
                
                usersRef.update(updates).then(() => {
                    alert(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${clicksToAdd} –∫–ª–∏–∫–æ–≤ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º`);
                    loadUserList();
                    loadLeaderboard();
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                    if (auth.currentUser) {
                        gameState.clicks += clicksToAdd;
                        gameState.bestScore = Math.max(gameState.bestScore, gameState.clicks);
                        updateGameDisplay();
                        saveGameState();
                    }
                });
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
        function addClicksToOnlineUsers(clicksToAdd) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤–∏–º –∫–ª–∏–∫–∏ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∏–Ω—É—Ç
            const tenMinutesAgo = Date.now() - (10 * 60 * 1000);
            const usersRef = database.ref('users');
            
            usersRef.once('value').then(snapshot => {
                const users = snapshot.val();
                const updates = {};
                let affectedUsers = 0;
                
                for (let userId in users) {
                    if (users[userId].lastActive && users[userId].lastActive > tenMinutesAgo) {
                        const currentClicks = users[userId].clicks || 0;
                        const currentBest = users[userId].bestScore || 0;
                        const newClicks = currentClicks + clicksToAdd;
                        const newBest = Math.max(currentBest, newClicks);
                        
                        updates[`${userId}/clicks`] = newClicks;
                        updates[`${userId}/bestScore`] = newBest;
                        affectedUsers++;
                    }
                }
                
                usersRef.update(updates).then(() => {
                    alert(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${clicksToAdd} –∫–ª–∏–∫–æ–≤ ${affectedUsers} –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º`);
                    loadUserList();
                    loadLeaderboard();
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                    if (auth.currentUser) {
                        gameState.clicks += clicksToAdd;
                        gameState.bestScore = Math.max(gameState.bestScore, gameState.clicks);
                        updateGameDisplay();
                        saveGameState();
                    }
                });
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–∫–æ–≤ —Å–µ–±–µ
        function addClicksToMe(clicksToAdd) {
            if (auth.currentUser) {
                const userRef = database.ref('users/' + auth.currentUser.uid);
                userRef.once('value').then(snapshot => {
                    const userData = snapshot.val();
                    const currentClicks = userData.clicks || 0;
                    const currentBest = userData.bestScore || 0;
                    const newClicks = currentClicks + clicksToAdd;
                    const newBest = Math.max(currentBest, newClicks);
                    
                    userRef.update({
                        clicks: newClicks,
                        bestScore: newBest
                    }).then(() => {
                        alert(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${clicksToAdd} –∫–ª–∏–∫–æ–≤ –≤–∞—à–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É`);
                        
                        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                        gameState.clicks = newClicks;
                        gameState.bestScore = newBest;
                        updateGameDisplay();
                    });
                });
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å –∫–ª–∏–∫–∞–º–∏
        function addClicksToOnlineHandler() {
            const clicksToAdd = parseInt(clicksToOnlineInput.value) || 0;
            if (clicksToAdd > 0) {
                addClicksToOnlineUsers(clicksToAdd);
            }
        }

        function addMyClicksHandler() {
            const clicksToAdd = parseInt(clicksToMeInput.value) || 0;
            if (clicksToAdd > 0) {
                addClicksToMe(clicksToAdd);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–±—ã—Ç–∏–π
        function showEventModal() {
            if (!isAdmin) {
                alert('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è');
                return;
            }
            eventModal.style.display = 'flex';
        }

        // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–±—ã—Ç–∏–π
        function hideEventModal() {
            eventModal.style.display = 'none';
        }

        // –ó–∞–ø—É—Å–∫ —Å–æ–±—ã—Ç–∏—è
        function startEventHandler() {
            const multiplier = parseFloat(eventMultiplier.value);
            const duration = parseInt(eventDuration.value);
            
            if (!isAdmin) {
                alert('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–æ–±—ã—Ç–∏—è');
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
            const eventRef = database.ref('currentEvent');
            const eventData = {
                multiplier: multiplier,
                endTime: Date.now() + (duration * 60 * 1000),
                active: true,
                startedBy: auth.currentUser.email,
                startTime: Date.now(),
                duration: duration
            };
            
            eventRef.set(eventData).then(() => {
                alert(`–°–æ–±—ã—Ç–∏–µ –∑–∞–ø—É—â–µ–Ω–æ! –ú–Ω–æ–∂–∏—Ç–µ–ª—å: ${multiplier}x, –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${duration} –º–∏–Ω—É—Ç`);
                hideEventModal();
                showEventNotification(eventData);
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç –æ –∑–∞–ø—É—Å–∫–µ —Å–æ–±—ã—Ç–∏—è
                sendSystemMessage(`üéâ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–ø—É—Å—Ç–∏–ª —Å–æ–±—ã—Ç–∏–µ! –í—Å–µ –∫–ª–∏–∫–∏ —É–º–Ω–æ–∂–∞—é—Ç—Å—è –Ω–∞ ${multiplier}x –Ω–∞ ${duration} –º–∏–Ω—É—Ç!`);
            });
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è
        function stopEventHandler() {
            if (!isAdmin) {
                alert('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è');
                return;
            }
            
            const eventRef = database.ref('currentEvent');
            eventRef.update({
                active: false
            }).then(() => {
                alert('–°–æ–±—ã—Ç–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                hideEventModal();
                eventNotification.style.display = 'none';
                gameState.clickMultiplier = 1;
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–æ–±—ã—Ç–∏—è
                sendSystemMessage('–°–æ–±—ã—Ç–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –ú–Ω–æ–∂–∏—Ç–µ–ª—å –∫–ª–∏–∫–æ–≤ —Å–±—Ä–æ—à–µ–Ω.');
            });
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
        function checkActiveEvent() {
            const eventRef = database.ref('currentEvent');
            eventRef.once('value').then(snapshot => {
                const eventData = snapshot.val();
                
                if (eventData && eventData.active) {
                    const timeLeft = eventData.endTime - Date.now();
                    
                    if (timeLeft > 0) {
                        // –°–æ–±—ã—Ç–∏–µ –∞–∫—Ç–∏–≤–Ω–æ
                        gameState.clickMultiplier = eventData.multiplier;
                        showEventNotification(eventData);
                    } else {
                        // –°–æ–±—ã—Ç–∏–µ –∏—Å—Ç–µ–∫–ª–æ
                        gameState.clickMultiplier = 1;
                        eventRef.update({ active: false });
                        eventNotification.style.display = 'none';
                    }
                } else {
                    // –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
                    gameState.clickMultiplier = 1;
                    eventNotification.style.display = 'none';
                }
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–æ–±—ã—Ç–∏–∏
        function showEventNotification(eventData) {
            const timeLeft = Math.max(0, eventData.endTime - Date.now());
            const minutes = Math.floor(timeLeft / (60 * 1000));
            const seconds = Math.floor((timeLeft % (60 * 1000)) / 1000);
            
            eventNotification.innerHTML = `
                <strong>–ê–ö–¢–ò–í–ù–û–ï –°–û–ë–´–¢–ò–ï!</strong> –í—Å–µ –∫–ª–∏–∫–∏ —É–º–Ω–æ–∂–∞—é—Ç—Å—è –Ω–∞ ${eventData.multiplier}x! 
                –û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏: <span id="eventTimer">${minutes}:${seconds < 10 ? '0' : ''}${seconds}</span>
                ${isAdmin ? `<br><button onclick="stopEventHandler()" style="margin-top: 5px; padding: 5px 10px; font-size: 0.8rem;">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>` : ''}
            `;
            eventNotification.style.display = 'block';
            
            // –¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
            const eventTimer = setInterval(() => {
                const timeLeft = Math.max(0, eventData.endTime - Date.now());
                const minutes = Math.floor(timeLeft / (60 * 1000));
                const seconds = Math.floor((timeLeft % (60 * 1000)) / 1000);
                
                const timerElement = document.getElementById('eventTimer');
                if (timerElement) {
                    timerElement.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                }
                
                if (timeLeft <= 0) {
                    clearInterval(eventTimer);
                    eventNotification.style.display = 'none';
                    gameState.clickMultiplier = 1;
                }
            }, 1000);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–∞—Ç–∞
        function loadChat() {
            const chatRef = database.ref('chat').limitToLast(50);
            chatRef.on('value', snapshot => {
                const messages = snapshot.val();
                chatMessages.innerHTML = '';
                
                if (messages) {
                    const messagesArray = Object.values(messages);
                    messagesArray.sort((a, b) => a.timestamp - b.timestamp);
                    
                    messagesArray.forEach(message => {
                        addMessageToChat(message);
                    });
                }
                
                // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        function addMessageToChat(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${message.type === 'admin' ? 'admin-action' : ''} ${message.type === 'system' ? 'system' : ''}`;
            
            const senderSpan = document.createElement('div');
            senderSpan.className = 'message-sender';
            
            const senderName = document.createElement('span');
            senderName.textContent = message.senderName;
            
            senderSpan.appendChild(senderName);
            
            if (message.verified) {
                const verifiedBadge = document.createElement('span');
                verifiedBadge.className = 'verified-badge';
                verifiedBadge.textContent = '‚úì';
                senderSpan.appendChild(verifiedBadge);
            }
            
            if (message.type === 'admin') {
                const adminBadge = document.createElement('span');
                adminBadge.className = 'admin-badge-chat';
                adminBadge.textContent = 'ADMIN';
                senderSpan.appendChild(adminBadge);
            }
            
            const textDiv = document.createElement('div');
            textDiv.className = 'message-text';
            textDiv.textContent = message.text;
            
            messageDiv.appendChild(senderSpan);
            messageDiv.appendChild(textDiv);
            
            chatMessages.appendChild(messageDiv);
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        function sendChatMessage() {
            if (!auth.currentUser) {
                alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è');
                return;
            }
            
            const messageText = chatInput.value.trim();
            if (!messageText) return;
            
            if (messageText.length > 200) {
                alert('–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ 200 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userRef = database.ref('users/' + auth.currentUser.uid);
            userRef.once('value').then(snapshot => {
                const userData = snapshot.val();
                
                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                const chatRef = database.ref('chat').push();
                chatRef.set({
                    senderId: auth.currentUser.uid,
                    senderName: userData.nickname || userData.email.split('@')[0],
                    text: messageText,
                    timestamp: Date.now(),
                    type: isAdmin ? 'admin' : 'user',
                    verified: userData.verified || false
                }).then(() => {
                    chatInput.value = '';
                });
            });
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        function sendSystemMessage(message) {
            const chatRef = database.ref('chat').push();
            chatRef.set({
                senderId: 'system',
                senderName: '–°–∏—Å—Ç–µ–º–∞',
                text: message,
                timestamp: Date.now(),
                type: 'system',
                verified: false
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π
        function loadFriends() {
            if (!auth.currentUser) return;
            
            const friendsRef = database.ref('friends/' + auth.currentUser.uid);
            friendsRef.on('value', snapshot => {
                const friends = snapshot.val();
                friendsList.innerHTML = '';
                
                if (friends) {
                    // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –∫–∞–∂–¥–æ–º –¥—Ä—É–≥–µ
                    Object.keys(friends).forEach(friendId => {
                        const userRef = database.ref('users/' + friendId);
                        userRef.once('value').then(snapshot => {
                            const userData = snapshot.val();
                            if (userData) {
                                addFriendToList(friendId, userData, friends[friendId]);
                            }
                        });
                    });
                } else {
                    friendsList.innerHTML = '<div style="text-align: center; padding: 20px;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</div>';
                }
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∞ –≤ —Å–ø–∏—Å–æ–∫
        function addFriendToList(friendId, userData, status) {
            const friendItem = document.createElement('div');
            friendItem.className = 'friend-item';
            friendItem.id = `friend-${friendId}`;
            
            const friendInfo = document.createElement('div');
            friendInfo.className = 'friend-info';
            
            const friendAvatar = document.createElement('div');
            friendAvatar.className = 'friend-avatar';
            friendAvatar.textContent = (userData.nickname || userData.email[0]).toUpperCase();
            
            const friendName = document.createElement('div');
            friendName.innerHTML = `
                <div>${userData.nickname || userData.email.split('@')[0]} ${userData.verified ? '<span class="verified-badge">‚úì</span>' : ''}</div>
                <div style="font-size: 0.8rem; opacity: 0.7;">–ö–ª–∏–∫–∏: ${userData.clicks || 0} | –õ—É—á—à–∏–π: ${userData.bestScore || 0}</div>
            `;
            
            friendInfo.appendChild(friendAvatar);
            friendInfo.appendChild(friendName);
            
            const friendActions = document.createElement('div');
            friendActions.className = 'friend-actions';
            
            if (status === 'pending') {
                const acceptBtn = document.createElement('button');
                acceptBtn.textContent = '–ü—Ä–∏–Ω—è—Ç—å';
                acceptBtn.addEventListener('click', () => acceptFriendRequest(friendId));
                
                const declineBtn = document.createElement('button');
                declineBtn.textContent = '–û—Ç–∫–ª–æ–Ω–∏—Ç—å';
                declineBtn.addEventListener('click', () => removeFriend(friendId));
                
                friendActions.appendChild(acceptBtn);
                friendActions.appendChild(declineBtn);
            } else {
                const removeBtn = document.createElement('button');
                removeBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
                removeBtn.addEventListener('click', () => removeFriend(friendId));
                
                friendActions.appendChild(removeBtn);
            }
            
            friendItem.appendChild(friendInfo);
            friendItem.appendChild(friendActions);
            
            friendsList.appendChild(friendItem);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥—Ä—É–≥–∞
        function showFriendsModal() {
            if (!auth.currentUser) {
                alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–ª—è—Ç—å –¥—Ä—É–∑–µ–π');
                return;
            }
            
            friendsModal.style.display = 'flex';
            friendSearchResults.innerHTML = '';
        }

        // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥—Ä—É–≥–∞
        function hideFriendsModal() {
            friendsModal.style.display = 'none';
            friendSearchInput.value = '';
            friendSearchResults.innerHTML = '';
        }

        // –ü–æ–∏—Å–∫ –¥—Ä—É–≥–∞
        function searchFriendHandler() {
            const searchTerm = friendSearchInput.value.trim().toLowerCase();
            if (!searchTerm) {
                alert('–í–≤–µ–¥–∏—Ç–µ email –∏–ª–∏ –Ω–∏–∫–Ω–µ–π–º –¥–ª—è –ø–æ–∏—Å–∫–∞');
                return;
            }
            
            const usersRef = database.ref('users');
            usersRef.once('value').then(snapshot => {
                const users = snapshot.val();
                const results = [];
                
                for (let userId in users) {
                    if (userId === auth.currentUser.uid) continue; // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–µ–±—è
                    
                    const user = users[userId];
                    const emailMatch = user.email.toLowerCase().includes(searchTerm);
                    const nicknameMatch = user.nickname && user.nickname.toLowerCase().includes(searchTerm);
                    
                    if (emailMatch || nicknameMatch) {
                        results.push({
                            id: userId,
                            email: user.email,
                            nickname: user.nickname,
                            clicks: user.clicks || 0,
                            bestScore: user.bestScore || 0,
                            verified: user.verified || false
                        });
                    }
                }
                
                displayFriendSearchResults(results);
            });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π
        function displayFriendSearchResults(results) {
            friendSearchResults.innerHTML = '';
            
            if (results.length === 0) {
                friendSearchResults.innerHTML = '<div style="text-align: center; padding: 10px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }
            
            results.forEach(user => {
                const resultItem = document.createElement('div');
                resultItem.className = 'user-item';
                resultItem.style.marginBottom = '10px';
                
                resultItem.innerHTML = `
                    <div class="user-info">
                        <div>${user.nickname || user.email.split('@')[0]} ${user.verified ? '<span class="verified-badge">‚úì</span>' : ''}</div>
                        <div style="font-size: 0.8rem; opacity: 0.7;">–ö–ª–∏–∫–∏: ${user.clicks} | –õ—É—á—à–∏–π: ${user.bestScore}</div>
                    </div>
                    <div class="user-actions">
                        <button class="add-friend">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                `;
                
                const addBtn = resultItem.querySelector('.add-friend');
                addBtn.addEventListener('click', () => sendFriendRequest(user.id));
                
                friendSearchResults.appendChild(resultItem);
            });
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –¥—Ä—É–∂–±—É
        function sendFriendRequest(friendId) {
            const myFriendsRef = database.ref('friends/' + auth.currentUser.uid + '/' + friendId);
            const theirFriendsRef = database.ref('friends/' + friendId + '/' + auth.currentUser.uid);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –ª–∏ –º—ã —É–∂–µ –∑–∞–ø—Ä–æ—Å
            myFriendsRef.once('value').then(snapshot => {
                if (snapshot.exists()) {
                    alert('–í—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∑–∞–ø—Ä–æ—Å —ç—Ç–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é');
                    return;
                }
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
                myFriendsRef.set('pending').then(() => {
                    theirFriendsRef.set('request').then(() => {
                        alert('–ó–∞–ø—Ä–æ—Å –Ω–∞ –¥—Ä—É–∂–±—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
                        hideFriendsModal();
                    });
                });
            });
        }

        // –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –¥—Ä—É–∂–±—É
        function acceptFriendRequest(friendId) {
            const myFriendsRef = database.ref('friends/' + auth.currentUser.uid + '/' + friendId);
            const theirFriendsRef = database.ref('friends/' + friendId + '/' + auth.currentUser.uid);
            
            myFriendsRef.set('accepted').then(() => {
                theirFriendsRef.set('accepted').then(() => {
                    alert('–ó–∞–ø—Ä–æ—Å –Ω–∞ –¥—Ä—É–∂–±—É –ø—Ä–∏–Ω—è—Ç');
                    loadFriends();
                });
            });
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∞
        function removeFriend(friendId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –¥—Ä—É–∑–µ–π?')) {
                return;
            }
            
            const myFriendsRef = database.ref('friends/' + auth.currentUser.uid + '/' + friendId);
            const theirFriendsRef = database.ref('friends/' + friendId + '/' + auth.currentUser.uid);
            
            myFriendsRef.remove().then(() => {
                theirFriendsRef.remove().then(() => {
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω –∏–∑ –¥—Ä—É–∑–µ–π');
                    loadFriends();
                });
            });
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        initApp();
    </script>
</body>
</html>